{"version":3,"sources":["../../src/utils/formats.ts"],"sourcesContent":["/**\n * TypeBox Format 验证器\n *\n * 内置常用的 format 验证，对标 Zod 的内置验证\n * 框架启动时自动注册\n *\n * @version 1.0.0\n */\n\nimport { FormatRegistry } from \"@sinclair/typebox\";\n\n// ============== 正则表达式 ==============\n\n// 邮箱 (RFC 5322 简化版)\nconst EMAIL_REGEX = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n\n// UUID v4\nconst UUID_REGEX = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n\n// UUID 任意版本\nconst UUID_ANY_REGEX = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n\n// CUID\nconst CUID_REGEX = /^c[^\\s-]{8,}$/i;\n\n// CUID2\nconst CUID2_REGEX = /^[0-9a-z]+$/;\n\n// ULID\nconst ULID_REGEX = /^[0-9A-HJKMNP-TV-Z]{26}$/i;\n\n// NanoID (默认 21 字符)\nconst NANOID_REGEX = /^[A-Za-z0-9_-]{21}$/;\n\n// URL\nconst URL_REGEX = /^https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b[-a-zA-Z0-9()@:%_+.~#?&/=]*$/;\n\n// IPv4\nconst IPV4_REGEX = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\n\n// IPv6 (简化版)\nconst IPV6_REGEX = /^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$|^::(?:[0-9a-fA-F]{1,4}:){0,6}[0-9a-fA-F]{1,4}$|^(?:[0-9a-fA-F]{1,4}:){1,7}:$|^(?:[0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}$|^(?:[0-9a-fA-F]{1,4}:){1,5}(?::[0-9a-fA-F]{1,4}){1,2}$|^(?:[0-9a-fA-F]{1,4}:){1,4}(?::[0-9a-fA-F]{1,4}){1,3}$|^(?:[0-9a-fA-F]{1,4}:){1,3}(?::[0-9a-fA-F]{1,4}){1,4}$|^(?:[0-9a-fA-F]{1,4}:){1,2}(?::[0-9a-fA-F]{1,4}){1,5}$|^[0-9a-fA-F]{1,4}:(?::[0-9a-fA-F]{1,4}){1,6}$/;\n\n// CIDR (IPv4)\nconst CIDR_REGEX = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\/(?:3[0-2]|[12]?[0-9])$/;\n\n// 日期 (YYYY-MM-DD)\nconst DATE_REGEX = /^\\d{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12][0-9]|3[01])$/;\n\n// 时间 (HH:mm:ss 或 HH:mm:ss.SSS)\nconst TIME_REGEX = /^(?:[01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9](?:\\.\\d{1,3})?$/;\n\n// ISO 日期时间\nconst DATE_TIME_REGEX = /^\\d{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12][0-9]|3[01])T(?:[01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9](?:\\.\\d{1,3})?(?:Z|[+-](?:[01][0-9]|2[0-3]):[0-5][0-9])?$/;\n\n// ISO 8601 Duration (P1Y2M3DT4H5M6S)\nconst DURATION_REGEX = /^P(?:\\d+Y)?(?:\\d+M)?(?:\\d+W)?(?:\\d+D)?(?:T(?:\\d+H)?(?:\\d+M)?(?:\\d+(?:\\.\\d+)?S)?)?$/;\n\n// Hostname (RFC 1123)\nconst HOSTNAME_REGEX = /^(?=.{1,253}$)(?:(?!-)[a-zA-Z0-9-]{1,63}(?<!-)\\.)*(?!-)[a-zA-Z0-9-]{1,63}(?<!-)$/;\n\n// 手机号 (中国大陆)\nconst PHONE_CN_REGEX = /^1[3-9]\\d{9}$/;\n\n// 手机号 (国际格式 E.164)\nconst PHONE_E164_REGEX = /^\\+[1-9]\\d{6,14}$/;\n\n// MongoDB ObjectId\nconst OBJECTID_REGEX = /^[0-9a-fA-F]{24}$/;\n\n// 十六进制颜色\nconst HEX_COLOR_REGEX = /^#(?:[0-9a-fA-F]{3}){1,2}$/;\n\n// RGB/RGBA 颜色\nconst RGB_COLOR_REGEX = /^rgba?\\(\\s*(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\s*,\\s*(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\s*,\\s*(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(?:\\s*,\\s*(?:0|1|0?\\.\\d+))?\\s*\\)$/;\n\n// Base64\nconst BASE64_REGEX = /^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/;\n\n// Base64 URL Safe\nconst BASE64URL_REGEX = /^[A-Za-z0-9_-]+$/;\n\n// JWT (3 部分 base64url)\nconst JWT_REGEX = /^[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+$/;\n\n// Emoji (简化检测)\nconst EMOJI_REGEX = /^[\\p{Emoji}]+$/u;\n\n// Slug (URL 友好字符串)\nconst SLUG_REGEX = /^[a-z0-9]+(?:-[a-z0-9]+)*$/;\n\n// Semver (语义化版本)\nconst SEMVER_REGEX = /^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$/;\n\n// 信用卡号 (Luhn 算法验证)\nfunction isValidCreditCard(value: string): boolean {\n  const digits = value.replace(/\\D/g, \"\");\n  if (digits.length < 13 || digits.length > 19) return false;\n\n  let sum = 0;\n  let isEven = false;\n  for (let i = digits.length - 1; i >= 0; i--) {\n    let digit = parseInt(digits[i], 10);\n    if (isEven) {\n      digit *= 2;\n      if (digit > 9) digit -= 9;\n    }\n    sum += digit;\n    isEven = !isEven;\n  }\n  return sum % 10 === 0;\n}\n\n// ============== Format 注册 ==============\n\nlet isRegistered = false;\n\n/**\n * 注册所有内置 format 验证器\n * 框架自动调用，也可手动调用\n */\nexport function registerFormats(): void {\n  if (isRegistered) return;\n  isRegistered = true;\n\n  // === 字符串标识符 ===\n  FormatRegistry.Set(\"email\", (v) => EMAIL_REGEX.test(v));\n  FormatRegistry.Set(\"uuid\", (v) => UUID_REGEX.test(v));\n  FormatRegistry.Set(\"uuid-any\", (v) => UUID_ANY_REGEX.test(v));\n  FormatRegistry.Set(\"cuid\", (v) => CUID_REGEX.test(v));\n  FormatRegistry.Set(\"cuid2\", (v) => CUID2_REGEX.test(v) && v.length >= 1);\n  FormatRegistry.Set(\"ulid\", (v) => ULID_REGEX.test(v));\n  FormatRegistry.Set(\"nanoid\", (v) => NANOID_REGEX.test(v));\n  FormatRegistry.Set(\"objectid\", (v) => OBJECTID_REGEX.test(v));\n  FormatRegistry.Set(\"slug\", (v) => SLUG_REGEX.test(v));\n\n  // === 网络相关 ===\n  FormatRegistry.Set(\"url\", (v) => URL_REGEX.test(v));\n  FormatRegistry.Set(\"uri\", (v) => URL_REGEX.test(v)); // 别名\n  FormatRegistry.Set(\"ipv4\", (v) => IPV4_REGEX.test(v));\n  FormatRegistry.Set(\"ipv6\", (v) => IPV6_REGEX.test(v));\n  FormatRegistry.Set(\"ip\", (v) => IPV4_REGEX.test(v) || IPV6_REGEX.test(v));\n  FormatRegistry.Set(\"cidr\", (v) => CIDR_REGEX.test(v));\n  FormatRegistry.Set(\"hostname\", (v) => HOSTNAME_REGEX.test(v));\n\n  // === 日期时间 ===\n  FormatRegistry.Set(\"date\", (v) => DATE_REGEX.test(v));\n  FormatRegistry.Set(\"time\", (v) => TIME_REGEX.test(v));\n  FormatRegistry.Set(\"date-time\", (v) => DATE_TIME_REGEX.test(v));\n  FormatRegistry.Set(\"datetime\", (v) => DATE_TIME_REGEX.test(v)); // 别名\n  FormatRegistry.Set(\"duration\", (v) => DURATION_REGEX.test(v));\n\n  // === 手机号 ===\n  FormatRegistry.Set(\"phone\", (v) => PHONE_CN_REGEX.test(v)); // 中国大陆\n  FormatRegistry.Set(\"phone-cn\", (v) => PHONE_CN_REGEX.test(v));\n  FormatRegistry.Set(\"phone-e164\", (v) => PHONE_E164_REGEX.test(v)); // 国际\n\n  // === 编码格式 ===\n  FormatRegistry.Set(\"base64\", (v) => BASE64_REGEX.test(v));\n  FormatRegistry.Set(\"base64url\", (v) => BASE64URL_REGEX.test(v));\n  FormatRegistry.Set(\"jwt\", (v) => JWT_REGEX.test(v));\n\n  // === 颜色 ===\n  FormatRegistry.Set(\"hex-color\", (v) => HEX_COLOR_REGEX.test(v));\n  FormatRegistry.Set(\"rgb-color\", (v) => RGB_COLOR_REGEX.test(v));\n  FormatRegistry.Set(\n    \"color\",\n    (v) => HEX_COLOR_REGEX.test(v) || RGB_COLOR_REGEX.test(v),\n  );\n\n  // === 其他 ===\n  FormatRegistry.Set(\"emoji\", (v) => EMOJI_REGEX.test(v));\n  FormatRegistry.Set(\"semver\", (v) => SEMVER_REGEX.test(v));\n  FormatRegistry.Set(\"credit-card\", isValidCreditCard);\n}\n\n/**\n * 自定义注册 format\n */\nexport function registerFormat(\n  name: string,\n  validator: (value: string) => boolean,\n): void {\n  FormatRegistry.Set(name, validator);\n}\n\n/**\n * 检查 format 是否已注册\n */\nexport function hasFormat(name: string): boolean {\n  return FormatRegistry.Has(name);\n}\n\n// 导出正则（供外部使用）\nexport const Patterns = {\n  EMAIL: EMAIL_REGEX,\n  UUID: UUID_REGEX,\n  URL: URL_REGEX,\n  IPV4: IPV4_REGEX,\n  IPV6: IPV6_REGEX,\n  DATE: DATE_REGEX,\n  TIME: TIME_REGEX,\n  DATE_TIME: DATE_TIME_REGEX,\n  PHONE_CN: PHONE_CN_REGEX,\n  PHONE_E164: PHONE_E164_REGEX,\n  OBJECTID: OBJECTID_REGEX,\n  HEX_COLOR: HEX_COLOR_REGEX,\n  SLUG: SLUG_REGEX,\n  SEMVER: SEMVER_REGEX,\n  JWT: JWT_REGEX,\n} as const;\n\n"],"mappings":"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","names":[]}