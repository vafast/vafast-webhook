import { TSchema, Static } from '@sinclair/typebox';
import { SchemaConfig } from './validators/validators.js';

/**
 * 请求解析和验证器
 *
 * 解析handler的req参数，使用Ultra验证器进行验证，
 * 并类型安全地返回解析出来的值
 *
 * @author Framework Team
 * @version 1.0.0
 * @license MIT
 */

interface RequestData {
    body: unknown;
    query: unknown;
    params: Record<string, string>;
    headers: Record<string, string>;
    cookies: Record<string, string>;
}
interface ValidatedRequestData<T extends SchemaConfig> {
    body: T["body"] extends TSchema ? Static<T["body"]> : unknown;
    query: T["query"] extends TSchema ? Static<T["query"]> : unknown;
    params: T["params"] extends TSchema ? Static<T["params"]> : Record<string, string>;
    headers: T["headers"] extends TSchema ? Static<T["headers"]> : Record<string, string>;
    cookies: T["cookies"] extends TSchema ? Static<T["cookies"]> : Record<string, string>;
}
interface ValidationResult<T extends SchemaConfig> {
    success: boolean;
    data?: ValidatedRequestData<T>;
    errors?: Array<{
        field: keyof SchemaConfig;
        message: string;
    }>;
}
/**
 * 解析Request对象，提取所有相关数据
 * @param request Request对象
 * @param params 路径参数（可选）
 * @returns 解析后的请求数据
 */
declare function parseRequest(request: Request, params?: Record<string, string>): Promise<RequestData>;
/**
 * 验证请求数据
 * @param config Schema配置
 * @param requestData 请求数据
 * @returns 验证结果
 */
declare function validateRequest<T extends SchemaConfig>(config: T, requestData: RequestData): ValidationResult<T>;
/**
 * 完整的请求解析和验证流程
 * @param request Request对象
 * @param config Schema配置
 * @param params 路径参数（可选）
 * @returns 验证结果
 */
declare function parseAndValidateRequest<T extends SchemaConfig>(request: Request, config: T, params?: Record<string, string>): Promise<ValidationResult<T>>;
/**
 * 创建类型安全的请求验证器工厂
 * @param config Schema配置
 * @returns 验证器函数
 */
declare function createRequestValidator<T extends SchemaConfig>(config: T): (request: Request, params?: Record<string, string>) => Promise<ValidationResult<T>>;

export { type RequestData, type ValidatedRequestData, type ValidationResult, createRequestValidator, parseAndValidateRequest, parseRequest, validateRequest };
