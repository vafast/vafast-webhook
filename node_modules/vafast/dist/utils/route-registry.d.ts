import { FlattenedRoute, Method } from '../types/types.js';

/**
 * 路由注册表
 *
 * 提供路由元信息的收集和查询能力
 * 可用于：API 文档生成、Webhook 事件注册、权限检查、审计日志等
 *
 * @example
 * ```typescript
 * // 创建注册表
 * const registry = createRouteRegistry(server.getRoutes())
 *
 * // 查询路由
 * const route = registry.get('POST', '/auth/signIn')
 *
 * // 筛选有 webhook 配置的路由
 * const webhookRoutes = registry.filter('webhook')
 *
 * // 按分类获取
 * const authRoutes = registry.getByCategory('auth')
 * ```
 */

/**
 * 路由元信息（不含 handler 和 middleware）
 */
interface RouteMeta {
    method: Method;
    path: string;
    fullPath: string;
    name?: string;
    description?: string;
    /** 扩展字段 */
    [key: string]: unknown;
}
/**
 * 路由注册表
 *
 * 泛型 T 用于定义扩展字段的类型
 */
declare class RouteRegistry<T extends Record<string, unknown> = Record<string, unknown>> {
    /** 所有路由元信息 */
    private routes;
    /** 路由映射表：METHOD:fullPath -> RouteMeta */
    private routeMap;
    /** 分类映射表：category -> RouteMeta[] */
    private categoryMap;
    constructor(routes: FlattenedRoute[]);
    /**
     * 构建注册表
     */
    private buildRegistry;
    /**
     * 提取分类（第一段路径）
     */
    private extractCategory;
    /**
     * 获取所有路由元信息
     */
    getAll(): RouteMeta[];
    /**
     * 按 method + path 查询路由
     */
    get(method: string, path: string): (RouteMeta & T) | undefined;
    /**
     * 检查路由是否存在
     */
    has(method: string, path: string): boolean;
    /**
     * 按分类获取路由
     */
    getByCategory(category: string): RouteMeta[];
    /**
     * 获取所有分类
     */
    getCategories(): string[];
    /**
     * 筛选有特定字段的路由
     *
     * @example
     * ```typescript
     * // 获取所有配置了 webhook 的路由
     * const webhookRoutes = registry.filter('webhook')
     * ```
     */
    filter<K extends string>(field: K): (RouteMeta & Record<K, unknown>)[];
    /**
     * 按条件筛选路由
     *
     * @example
     * ```typescript
     * // 获取所有 POST 请求
     * const postRoutes = registry.filterBy(r => r.method === 'POST')
     * ```
     */
    filterBy(predicate: (route: RouteMeta) => boolean): RouteMeta[];
    /**
     * 获取路由数量
     */
    get size(): number;
    /**
     * 遍历所有路由
     */
    forEach(callback: (route: RouteMeta, index: number) => void): void;
    /**
     * 映射所有路由
     */
    map<R>(callback: (route: RouteMeta, index: number) => R): R[];
}
/**
 * 创建路由注册表
 *
 * @example
 * ```typescript
 * // 定义扩展字段类型
 * interface MyRouteMeta {
 *   webhook?: { eventKey: string }
 *   permission?: string
 * }
 *
 * // 创建带类型的注册表
 * const registry = createRouteRegistry<MyRouteMeta>(server.getRoutes())
 *
 * // 类型安全的查询
 * const route = registry.get('POST', '/auth/signIn')
 * if (route?.webhook) {
 *   console.log(route.webhook.eventKey)
 * }
 * ```
 */
declare function createRouteRegistry<T extends Record<string, unknown> = Record<string, unknown>>(routes: FlattenedRoute[]): RouteRegistry<T>;
/**
 * 设置全局 registry（框架内部使用）
 * @internal
 */
declare function setGlobalRegistry(registry: RouteRegistry): void;
/**
 * 获取全局路由注册表
 *
 * @example
 * ```typescript
 * // 在任意文件中
 * import { getRouteRegistry } from 'vafast'
 *
 * const registry = getRouteRegistry()
 * const webhookRoutes = registry.filter('webhook')
 * ```
 *
 * @throws 如果 Server 尚未创建
 */
declare function getRouteRegistry<T extends Record<string, unknown> = Record<string, unknown>>(): RouteRegistry<T>;
/**
 * 按 method + path 获取单个路由
 *
 * 便捷函数，无需先获取 registry
 *
 * @example
 * ```typescript
 * // 在中间件或接口中
 * import { getRoute } from 'vafast'
 *
 * const route = getRoute('POST', '/auth/signIn')
 * if (route?.webhook) {
 *   console.log('This route has webhook:', route.webhook)
 * }
 * ```
 */
declare function getRoute<T extends Record<string, unknown> = Record<string, unknown>>(method: string, path: string): (RouteMeta & T) | undefined;
/**
 * 获取所有路由
 *
 * @example
 * ```typescript
 * import { getAllRoutes } from 'vafast'
 *
 * const routes = getAllRoutes()
 * console.log(`Total ${routes.length} routes`)
 * ```
 */
declare function getAllRoutes(): RouteMeta[];
/**
 * 筛选有特定字段的路由
 *
 * @example
 * ```typescript
 * import { filterRoutes } from 'vafast'
 *
 * // 获取所有配置了 webhook 的路由
 * const webhookRoutes = filterRoutes('webhook')
 * ```
 */
declare function filterRoutes<K extends string>(field: K): (RouteMeta & Record<K, unknown>)[];

export { type RouteMeta, RouteRegistry, createRouteRegistry, filterRoutes, getAllRoutes, getRoute, getRouteRegistry, setGlobalRegistry };
