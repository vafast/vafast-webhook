{"version":3,"sources":["../../src/utils/parsers.ts","../../src/utils/go-await.ts","../../src/utils/response.ts","../../src/utils/validators/validators.ts","../../src/utils/create-handler.ts","../../src/utils/base64url.ts","../../src/utils/handle.ts","../../src/utils/request-validator.ts","../../src/utils/html-renderer.ts","../../src/utils/dependency-manager.ts","../../src/utils/formats.ts","../../src/utils/sse.ts","../../src/utils/route-registry.ts"],"sourcesContent":["// src/parsers.ts\nimport qs from \"qs\";\nimport cookie from \"cookie\";\n\n// æ–‡ä»¶ä¿¡æ¯æ¥å£\nexport interface FileInfo {\n  name: string;\n  type: string;\n  size: number;\n  data: ArrayBuffer;\n}\n\n// è¡¨å•æ•°æ®æ¥å£\nexport interface FormData {\n  fields: Record<string, string>;\n  files: Record<string, FileInfo>;\n}\n\n/**\n * ç®€åŒ–çš„è¯·æ±‚ä½“è§£æå‡½æ•°\n * ä¼˜å…ˆç®€æ´æ€§ï¼Œå¤„ç†æœ€å¸¸è§çš„åœºæ™¯\n */\nexport async function parseBody(req: Request): Promise<unknown> {\n  const contentType = req.headers.get(\"content-type\") || \"\";\n  if (contentType.includes(\"application/json\")) {\n    return await req.json();\n  }\n  if (contentType.includes(\"application/x-www-form-urlencoded\")) {\n    const text = await req.text();\n    return Object.fromEntries(new URLSearchParams(text));\n  }\n  return await req.text(); // fallback\n}\n\n/**\n * è§£æ multipart/form-data æ ¼å¼\n * æ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œæ™®é€šè¡¨å•å­—æ®µ\n */\nasync function parseMultipartFormData(req: Request): Promise<FormData> {\n  const formData = await req.formData();\n  const result: FormData = {\n    fields: {},\n    files: {},\n  };\n\n  for (const [key, value] of formData.entries()) {\n    if (\n      typeof value === \"object\" &&\n      value !== null &&\n      \"name\" in value &&\n      \"type\" in value &&\n      \"size\" in value\n    ) {\n      // å¤„ç†æ–‡ä»¶\n      const file = value as any;\n      const arrayBuffer = await file.arrayBuffer();\n      result.files[key] = {\n        name: file.name,\n        type: file.type,\n        size: file.size,\n        data: arrayBuffer,\n      };\n    } else {\n      // å¤„ç†æ™®é€šå­—æ®µ\n      result.fields[key] = value as string;\n    }\n  }\n\n  return result;\n}\n\n/**\n * è§£æè¯·æ±‚ä½“ä¸ºç‰¹å®šç±»å‹\n * æä¾›ç±»å‹å®‰å…¨çš„è§£ææ–¹æ³•\n */\nexport async function parseBodyAs<T>(req: Request): Promise<T> {\n  const body = await parseBody(req);\n  return body as T;\n}\n\n/**\n * è§£æè¯·æ±‚ä½“ä¸ºè¡¨å•æ•°æ®\n * ä¸“é—¨ç”¨äºå¤„ç† multipart/form-data\n */\nexport async function parseFormData(req: Request): Promise<FormData> {\n  const contentType = req.headers.get(\"content-type\") || \"\";\n\n  if (!contentType.includes(\"multipart/form-data\")) {\n    throw new Error(\"è¯·æ±‚ä¸æ˜¯ multipart/form-data æ ¼å¼\");\n  }\n\n  return await parseMultipartFormData(req);\n}\n\n/**\n * è§£æè¯·æ±‚ä½“ä¸ºæ–‡ä»¶\n * ä¸“é—¨ç”¨äºå¤„ç†æ–‡ä»¶ä¸Šä¼ \n */\nexport async function parseFile(req: Request): Promise<FileInfo> {\n  const contentType = req.headers.get(\"content-type\") || \"\";\n\n  if (!contentType.includes(\"multipart/form-data\")) {\n    throw new Error(\"è¯·æ±‚ä¸æ˜¯ multipart/form-data æ ¼å¼\");\n  }\n\n  const formData = await parseMultipartFormData(req);\n  const fileKeys = Object.keys(formData.files);\n\n  if (fileKeys.length === 0) {\n    throw new Error(\"è¯·æ±‚ä¸­æ²¡æœ‰æ–‡ä»¶\");\n  }\n\n  if (fileKeys.length > 1) {\n    throw new Error(\"è¯·æ±‚ä¸­åŒ…å«å¤šä¸ªæ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ parseFormData\");\n  }\n\n  return formData.files[fileKeys[0]];\n}\n\n/**\n * å¿«é€Ÿæå– query stringï¼ˆé¿å…åˆ›å»º URL å¯¹è±¡ï¼‰\n */\nfunction extractQueryString(url: string): string {\n  const qIndex = url.indexOf(\"?\");\n  if (qIndex === -1) return \"\";\n\n  const hashIndex = url.indexOf(\"#\", qIndex);\n  return hashIndex === -1\n    ? url.substring(qIndex + 1)\n    : url.substring(qIndex + 1, hashIndex);\n}\n\n/** è·å–æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›å¯¹è±¡ */\nexport function parseQuery(req: Request): Record<string, unknown> {\n  const queryString = extractQueryString(req.url);\n  if (!queryString) return {};\n  return qs.parse(queryString);\n}\n\n/**\n * å¿«é€Ÿè§£æç®€å•æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆä¸æ”¯æŒåµŒå¥—ï¼Œä½†æ›´å¿«ï¼‰\n * é€‚ç”¨äºç®€å•çš„ key=value&key2=value2 åœºæ™¯\n */\nexport function parseQueryFast(req: Request): Record<string, string> {\n  const queryString = extractQueryString(req.url);\n  if (!queryString) return {};\n\n  const result: Record<string, string> = Object.create(null);\n  const pairs = queryString.split(\"&\");\n\n  for (const pair of pairs) {\n    const eqIndex = pair.indexOf(\"=\");\n    if (eqIndex === -1) {\n      result[decodeURIComponent(pair)] = \"\";\n    } else {\n      const key = decodeURIComponent(pair.substring(0, eqIndex));\n      const value = decodeURIComponent(pair.substring(eqIndex + 1));\n      result[key] = value;\n    }\n  }\n\n  return result;\n}\n\n/** è§£æè¯·æ±‚å¤´ï¼Œè¿”å›å¯¹è±¡ */\nexport function parseHeaders(req: Request): Record<string, string> {\n  const headers: Record<string, string> = Object.create(null);\n  req.headers.forEach((value, key) => {\n    headers[key] = value;\n  });\n  return headers;\n}\n\n/**\n * è·å–å•ä¸ªè¯·æ±‚å¤´ï¼ˆé¿å…è§£æå…¨éƒ¨ï¼‰\n */\nexport function getHeader(req: Request, name: string): string | null {\n  return req.headers.get(name);\n}\n\n/** ä½¿ç”¨cookieåº“è§£æCookieï¼Œä¿è¯å¯é æ€§ */\nexport function parseCookies(req: Request): Record<string, string> {\n  const cookieHeader = req.headers.get(\"cookie\");\n  if (!cookieHeader) return {};\n\n  try {\n    const parsed = cookie.parse(cookieHeader);\n    // è¿‡æ»¤æ‰undefinedå’Œnullå€¼\n    const result: Record<string, string> = {};\n    for (const [key, value] of Object.entries(parsed)) {\n      if (value !== undefined && value !== null) {\n        result[key] = value;\n      }\n    }\n    return result;\n  } catch {\n    return {};\n  }\n}\n\n/**\n * å¿«é€Ÿè§£æ Cookieï¼ˆç®€åŒ–ç‰ˆï¼Œä¸ä½¿ç”¨å¤–éƒ¨åº“ï¼‰\n * é€‚ç”¨äºç®€å•çš„ cookie åœºæ™¯\n */\nexport function parseCookiesFast(req: Request): Record<string, string> {\n  const cookieHeader = req.headers.get(\"cookie\");\n  if (!cookieHeader) return {};\n\n  const result: Record<string, string> = Object.create(null);\n  const pairs = cookieHeader.split(\";\");\n\n  for (const pair of pairs) {\n    const trimmed = pair.trim();\n    const eqIndex = trimmed.indexOf(\"=\");\n    if (eqIndex > 0) {\n      const key = trimmed.substring(0, eqIndex).trim();\n      const value = trimmed.substring(eqIndex + 1).trim();\n      // ç§»é™¤å¼•å·\n      result[key] =\n        value.startsWith('\"') && value.endsWith('\"')\n          ? value.slice(1, -1)\n          : value;\n    }\n  }\n\n  return result;\n}\n\n/**\n * è·å–å•ä¸ª Cookie å€¼ï¼ˆé¿å…è§£æå…¨éƒ¨ï¼‰\n */\nexport function getCookie(req: Request, name: string): string | null {\n  const cookieHeader = req.headers.get(\"cookie\");\n  if (!cookieHeader) return null;\n\n  const prefix = `${name}=`;\n  const pairs = cookieHeader.split(\";\");\n\n  for (const pair of pairs) {\n    const trimmed = pair.trim();\n    if (trimmed.startsWith(prefix)) {\n      const value = trimmed.substring(prefix.length).trim();\n      return value.startsWith('\"') && value.endsWith('\"')\n        ? value.slice(1, -1)\n        : value;\n    }\n  }\n\n  return null;\n}\n","/**\n * Go é£æ ¼çš„é”™è¯¯å¤„ç†å·¥å…·\n * å°† Promise è½¬æ¢ä¸º [Error | null, T | undefined] æ ¼å¼\n *\n * @author Framework Team\n * @version 1.0.0\n * @license MIT\n */\n\n/**\n * Go é£æ ¼çš„é”™è¯¯å¤„ç†å·¥å…·\n * å°† Promise è½¬æ¢ä¸º [Error | null, T | undefined] æ ¼å¼\n *\n * @param promise è¦å¤„ç†çš„ Promise\n * @returns [Error | null, T | undefined] å…ƒç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯é”™è¯¯ï¼Œç¬¬äºŒä¸ªæ˜¯ç»“æœ\n *\n * @example\n * ```typescript\n * const [error, result] = await goAwait(someAsyncFunction());\n * if (error) {\n *   console.error(\"æ“ä½œå¤±è´¥:\", error);\n * } else {\n *   console.log(\"æ“ä½œæˆåŠŸ:\", result);\n * }\n * ```\n */\nexport function goAwait<T>(\n  promise: Promise<T>,\n): Promise<[Error | null, T | undefined]> {\n  return promise\n    .then<[null, T]>((data) => [null, data])\n    .catch<\n      [Error, undefined]\n    >((err) => [err instanceof Error ? err : new Error(String(err)), undefined]);\n}\n","// src/response.ts\n\n/** ç”Ÿæˆ JSON å“åº” */\nexport function json(\n  data: unknown,\n  status = 200,\n  headers: HeadersInit = {},\n): Response {\n  const body = JSON.stringify(data);\n\n  // ä¼˜åŒ–ï¼šåªåœ¨æœ‰è‡ªå®šä¹‰ headers æ—¶æ‰åˆ›å»º Headers å¯¹è±¡\n  if (Object.keys(headers).length === 0) {\n    return new Response(body, {\n      status,\n      headers: { \"Content-Type\": \"application/json\" },\n    });\n  }\n\n  // æœ‰è‡ªå®šä¹‰ headers æ—¶æ‰åˆ›å»º Headers å¯¹è±¡\n  const h = new Headers({\n    \"Content-Type\": \"application/json\",\n    ...headers,\n  });\n\n  return new Response(body, {\n    status,\n    headers: h,\n  });\n}\n\n// JSON å“åº”çš„é¢„åˆ›å»º headersï¼ˆé¿å…æ¯æ¬¡åˆ›å»ºï¼‰\nconst JSON_HEADERS = { \"Content-Type\": \"application/json\" };\nconst TEXT_HEADERS = { \"Content-Type\": \"text/plain\" };\n\n/**\n * ç±»å‹ç‰¹åŒ–çš„å“åº”æ˜ å°„\n * æ ¹æ®è¿”å›å€¼ç±»å‹ç›´æ¥ç”Ÿæˆ Responseï¼Œé¿å…ä¸å¿…è¦çš„æ£€æŸ¥\n */\nexport function mapResponse(response: unknown): Response {\n  // å¿«é€Ÿè·¯å¾„ï¼šå·²ç»æ˜¯ Response\n  if (response instanceof Response) return response;\n\n  // ä½¿ç”¨ constructor.name è¿›è¡Œç±»å‹åˆ¤æ–­ï¼ˆæ¯” instanceof æ›´å¿«ï¼‰\n  switch (response?.constructor?.name) {\n    case \"String\":\n      return new Response(response as string, { headers: TEXT_HEADERS });\n\n    case \"Object\":\n    case \"Array\":\n      return new Response(JSON.stringify(response), { headers: JSON_HEADERS });\n\n    case \"Number\":\n    case \"Boolean\":\n      return new Response(String(response), { headers: TEXT_HEADERS });\n\n    case undefined:\n      // null æˆ– undefined\n      return new Response(null, { status: 204 });\n\n    case \"ReadableStream\":\n      return new Response(response as ReadableStream);\n\n    case \"Blob\":\n      return new Response(response as Blob);\n\n    case \"ArrayBuffer\":\n      return new Response(response as ArrayBuffer);\n\n    case \"Uint8Array\":\n      return new Response(response as unknown as BodyInit);\n\n    default:\n      // Promise å¤„ç†\n      if (response instanceof Promise) {\n        return response.then(mapResponse) as unknown as Response;\n      }\n      // å…¶ä»–æƒ…å†µä½¿ç”¨ JSON åºåˆ—åŒ–\n      return new Response(JSON.stringify(response), { headers: JSON_HEADERS });\n  }\n}\n\n/** ç”Ÿæˆé‡å®šå‘å“åº” */\nexport function redirect(location: string, status: 301 | 302 = 302): Response {\n  return new Response(null, {\n    status,\n    headers: {\n      Location: location,\n    },\n  });\n}\n\n/** ç”Ÿæˆçº¯æ–‡æœ¬å“åº” */\nexport function text(\n  content: string,\n  status = 200,\n  headers: HeadersInit = {},\n): Response {\n  const h = new Headers({\n    \"Content-Type\": \"text/plain; charset=utf-8\",\n    ...headers,\n  });\n\n  return new Response(content, {\n    status,\n    headers: h,\n  });\n}\n\n/** ç”ŸæˆHTMLå“åº” */\nexport function html(\n  content: string,\n  status = 200,\n  headers: HeadersInit = {},\n): Response {\n  const h = new Headers({\n    \"Content-Type\": \"text/html; charset=utf-8\",\n    ...headers,\n  });\n\n  return new Response(content, {\n    status,\n    headers: h,\n  });\n}\n\n/** ç”Ÿæˆç©ºå“åº”ï¼ˆ204 No Contentï¼‰ */\nexport function empty(status = 204, headers: HeadersInit = {}): Response {\n  return new Response(null, {\n    status,\n    headers,\n  });\n}\n\n/** ç”Ÿæˆæµå¼å“åº” */\nexport function stream(\n  stream: ReadableStream,\n  status = 200,\n  headers: HeadersInit = {},\n): Response {\n  const h = new Headers({\n    \"Content-Type\": \"application/octet-stream\",\n    ...headers,\n  });\n\n  return new Response(stream, {\n    status,\n    headers: h,\n  });\n}\n","/**\n * Schema éªŒè¯å™¨ - ç®€æ´ç‰ˆ\n *\n * ç‰¹ç‚¹ï¼š\n * - WeakMap ç¼“å­˜é¿å…å†…å­˜æ³„æ¼\n * - TypeCompiler JIT ç¼–è¯‘ï¼Œæ€§èƒ½æœ€ä½³\n * - æ”¯æŒ FormatRegistryï¼ˆéœ€ç¡®ä¿åŒä¸€å®ä¾‹ï¼‰\n *\n * @version 7.0.0\n */\n\nimport { Type } from \"@sinclair/typebox\";\nimport type { Static, TSchema } from \"@sinclair/typebox\";\nimport { TypeCompiler, type TypeCheck } from \"@sinclair/typebox/compiler\";\nimport { Value } from \"@sinclair/typebox/value\";\n\n// ============== ç±»å‹å®šä¹‰ ==============\n\n/** Schema é…ç½®æ¥å£ */\nexport interface SchemaConfig {\n  body?: TSchema;\n  query?: TSchema;\n  params?: TSchema;\n  headers?: TSchema;\n  cookies?: TSchema;\n}\n\n/** éªŒè¯é”™è¯¯æ¥å£ */\nexport interface ValidationError {\n  path: string;\n  message: string;\n  code: string;\n  value?: unknown;\n}\n\n/** éªŒè¯ç»“æœ */\nexport type ValidationResult<T = unknown> =\n  | { success: true; data: T }\n  | { success: false; errors: ValidationError[] };\n\n// ============== ç¼“å­˜ ==============\n\n/** ç¼–è¯‘å™¨ç¼“å­˜ - WeakMap é¿å…å†…å­˜æ³„æ¼ */\nconst compilerCache = new WeakMap<TSchema, TypeCheck<TSchema>>();\n\n// ============== æ ¸å¿ƒå‡½æ•° ==============\n\n/**\n * è·å–æˆ–åˆ›å»ºç¼–è¯‘åçš„éªŒè¯å™¨\n */\nfunction getCompiledValidator<T extends TSchema>(schema: T): TypeCheck<T> {\n  let compiler = compilerCache.get(schema);\n  if (!compiler) {\n    compiler = TypeCompiler.Compile(schema);\n    compilerCache.set(schema, compiler);\n  }\n  return compiler as TypeCheck<T>;\n}\n\n/**\n * éªŒè¯å•ä¸ª Schemaï¼ˆè¿”å›ç»“æœå¯¹è±¡ï¼‰\n */\nexport function validateSchema<T extends TSchema>(\n  schema: T,\n  data: unknown,\n): ValidationResult<Static<T>> {\n  try {\n    const compiler = getCompiledValidator(schema);\n\n    if (compiler.Check(data)) {\n      return { success: true, data: data as Static<T> };\n    }\n\n    // æ”¶é›†é”™è¯¯\n    const errors: ValidationError[] = [];\n    for (const error of compiler.Errors(data)) {\n      errors.push({\n        path: error.path,\n        message: error.message,\n        code: \"VALIDATION_FAILED\",\n        value: error.value,\n      });\n    }\n    return { success: false, errors };\n  } catch (error) {\n    return {\n      success: false,\n      errors: [\n        {\n          path: \"\",\n          message: error instanceof Error ? error.message : \"éªŒè¯å¼‚å¸¸\",\n          code: \"VALIDATION_EXCEPTION\",\n        },\n      ],\n    };\n  }\n}\n\n/**\n * éªŒè¯ Schemaï¼ˆæŠ›å‡ºå¼‚å¸¸ç‰ˆæœ¬ï¼Œç”¨äºæ¡†æ¶å†…éƒ¨ï¼‰\n */\nexport function validateSchemaOrThrow<T extends TSchema>(\n  schema: T,\n  data: unknown,\n  context: string,\n): Static<T> {\n  const compiler = getCompiledValidator(schema);\n\n  if (!compiler.Check(data)) {\n    throw new Error(`${context}éªŒè¯å¤±è´¥`);\n  }\n\n  return data as Static<T>;\n}\n\n/**\n * å¿«é€ŸéªŒè¯ï¼ˆåªè¿”å›å¸ƒå°”å€¼ï¼‰\n */\nexport function validateFast<T extends TSchema>(\n  schema: T,\n  data: unknown,\n): data is Static<T> {\n  const compiler = getCompiledValidator(schema);\n  return compiler.Check(data);\n}\n\n/**\n * æ‰¹é‡éªŒè¯æ‰€æœ‰ Schemaï¼ˆç”¨äºè¯·æ±‚éªŒè¯ï¼‰\n */\nexport function validateAllSchemas(\n  config: SchemaConfig,\n  data: {\n    body: unknown;\n    query: unknown;\n    params: unknown;\n    headers: unknown;\n    cookies: unknown;\n  },\n): typeof data {\n  if (config.body) {\n    validateSchemaOrThrow(config.body, data.body, \"è¯·æ±‚ä½“\");\n  }\n  if (config.query) {\n    validateSchemaOrThrow(config.query, data.query, \"Queryå‚æ•°\");\n  }\n  if (config.params) {\n    validateSchemaOrThrow(config.params, data.params, \"è·¯å¾„å‚æ•°\");\n  }\n  if (config.headers) {\n    validateSchemaOrThrow(config.headers, data.headers, \"è¯·æ±‚å¤´\");\n  }\n  if (config.cookies) {\n    validateSchemaOrThrow(config.cookies, data.cookies, \"Cookie\");\n  }\n  return data;\n}\n\n/**\n * é¢„ç¼–è¯‘ Schemaï¼ˆå¯åŠ¨æ—¶è°ƒç”¨ï¼Œé¿å…é¦–æ¬¡è¯·æ±‚å¼€é”€ï¼‰\n */\nexport function precompileSchemas(config: SchemaConfig): void {\n  if (config.body) getCompiledValidator(config.body);\n  if (config.query) getCompiledValidator(config.query);\n  if (config.params) getCompiledValidator(config.params);\n  if (config.headers) getCompiledValidator(config.headers);\n  if (config.cookies) getCompiledValidator(config.cookies);\n}\n\n/**\n * åˆ›å»ºç±»å‹ç‰¹åŒ–çš„éªŒè¯å™¨ï¼ˆé«˜é¢‘ä½¿ç”¨åœºæ™¯ï¼‰\n */\nexport function createValidator<T extends TSchema>(\n  schema: T,\n): (data: unknown) => ValidationResult<Static<T>> {\n  return (data: unknown) => validateSchema(schema, data);\n}\n\n/**\n * è·å–ç¼“å­˜ç»Ÿè®¡ï¼ˆè°ƒè¯•ç”¨ï¼‰\n */\nexport function getValidatorCacheStats(): { cacheType: string; note: string } {\n  return {\n    cacheType: \"WeakMap\",\n    note: \"WeakMap ç¼“å­˜ä¼šéš Schema å¯¹è±¡è‡ªåŠ¨æ¸…ç†ï¼Œæ— å†…å­˜æ³„æ¼é£é™©\",\n  };\n}\n\n// å¯¼å‡º TypeBox ç±»å‹\nexport { Type, Static, TSchema };\n","/**\n * ç±»å‹å®‰å…¨çš„è·¯ç”±å¤„ç†å™¨å·¥å‚\n *\n * éæŸ¯é‡ŒåŒ–è®¾è®¡ï¼ŒAPI æ›´ç®€æ´\n *\n * @author Framework Team\n * @version 3.0.0\n * @license MIT\n */\n\nimport type {\n  RouteSchema,\n  HandlerContext,\n  HandlerContextWithExtra,\n} from \"../types/schema\";\nimport { parseBody, parseQuery, parseHeaders, parseCookies } from \"./parsers\";\nimport { goAwait } from \"./go-await\";\nimport { json } from \"./response\";\nimport {\n  validateAllSchemas,\n  precompileSchemas,\n} from \"./validators/validators\";\n\n/**\n * è‡ªåŠ¨å“åº”è½¬æ¢\n * å°†å„ç§è¿”å›å€¼ç±»å‹è½¬æ¢ä¸º Response å¯¹è±¡\n */\nfunction autoResponse(result: unknown): Response {\n  // å·²ç»æ˜¯ Response\n  if (result instanceof Response) {\n    return result;\n  }\n\n  // null/undefined -> 204\n  if (result === null || result === undefined) {\n    return new Response(null, { status: 204 });\n  }\n\n  // å­—ç¬¦ä¸² -> text/plain\n  if (typeof result === \"string\") {\n    return new Response(result, {\n      headers: { \"Content-Type\": \"text/plain; charset=utf-8\" },\n    });\n  }\n\n  // æ•°å­—/å¸ƒå°” -> text/plain\n  if (typeof result === \"number\" || typeof result === \"boolean\") {\n    return new Response(String(result), {\n      headers: { \"Content-Type\": \"text/plain; charset=utf-8\" },\n    });\n  }\n\n  // å¯¹è±¡ -> æ£€æŸ¥æ˜¯å¦æ˜¯ { data, status, headers } æ ¼å¼\n  if (typeof result === \"object\") {\n    const obj = result as Record<string, unknown>;\n    if (\"data\" in obj && (\"status\" in obj || \"headers\" in obj)) {\n      const { data, status = 200, headers = {} } = obj;\n\n      if (data === null || data === undefined) {\n        return new Response(null, {\n          status: status === 200 ? 204 : (status as number),\n          headers: headers as HeadersInit,\n        });\n      }\n\n      if (\n        typeof data === \"string\" ||\n        typeof data === \"number\" ||\n        typeof data === \"boolean\"\n      ) {\n        return new Response(String(data), {\n          status: status as number,\n          headers: {\n            \"Content-Type\": \"text/plain; charset=utf-8\",\n            ...(headers as Record<string, string>),\n          },\n        });\n      }\n\n      return json(data, status as number, headers as Record<string, string>);\n    }\n\n    // æ™®é€šå¯¹è±¡ -> JSON\n    return json(result);\n  }\n\n  // å…¶ä»–ç±»å‹ -> 204\n  return new Response(null, { status: 204 });\n}\n\n/**\n * å¤„ç†éªŒè¯é”™è¯¯\n */\nfunction handleValidationError(error: Error): Response {\n  return json(\n    {\n      success: false,\n      error: \"Validation Error\",\n      message: error.message,\n      timestamp: new Date().toISOString(),\n    },\n    400,\n  );\n}\n\n/**\n * å¤„ç†å†…éƒ¨é”™è¯¯\n */\nfunction handleInternalError(error: unknown): Response {\n  return json(\n    {\n      success: false,\n      error: \"Internal Error\",\n      message: error instanceof Error ? error.message : \"æœªçŸ¥é”™è¯¯\",\n    },\n    500,\n  );\n}\n\n/** ç©º schema çš„ä¸Šä¸‹æ–‡ç±»å‹ */\ntype EmptySchemaContext = {\n  req: Request;\n  body: unknown;\n  query: Record<string, string>;\n  params: Record<string, string>;\n  headers: Record<string, string>;\n  cookies: Record<string, string>;\n};\n\n/**\n * åˆ¤æ–­æ˜¯å¦ä¸º handler å‡½æ•°\n */\nfunction isHandler(value: unknown): value is (...args: unknown[]) => unknown {\n  return typeof value === \"function\";\n}\n\n/**\n * åˆ›å»ºç±»å‹å®‰å…¨çš„è·¯ç”±å¤„ç†å™¨\n *\n * @example\n * ```typescript\n * // æ—  schema - ç›´æ¥ä¼ å…¥ handler\n * createHandler(({ params }) => `User: ${params.id}`)\n *\n * // æœ‰ schema - ä¼ å…¥ schema å’Œ handler\n * createHandler(\n *   { body: Type.Object({ name: Type.String() }) },\n *   ({ body }) => ({ hello: body.name })\n * )\n * ```\n */\n/**\n * å¸¦ç±»å‹æ¨æ–­çš„ Handler - ä¿ç•™è¿”å›ç±»å‹ä¿¡æ¯ç”¨äºå®¢æˆ·ç«¯ç±»å‹æ¨æ–­\n */\nexport type InferableHandler<TReturn, TSchema extends RouteSchema = RouteSchema> = ((req: Request) => Promise<Response>) & {\n  /** è¿”å›ç±»å‹æ ‡è®°ï¼ˆä»…ç”¨äºç±»å‹æ¨æ–­ï¼Œè¿è¡Œæ—¶ä¸å­˜åœ¨ï¼‰ */\n  __returnType: TReturn;\n  /** Schema ç±»å‹æ ‡è®° */\n  __schema: TSchema;\n};\n\n\n// é‡è½½ 1: æ—  schema\nexport function createHandler<R>(\n  handler: (ctx: EmptySchemaContext) => R | Promise<R>,\n): InferableHandler<R>;\n\n// é‡è½½ 2: æœ‰ schema\nexport function createHandler<const T extends RouteSchema, R>(\n  schema: T,\n  handler: (ctx: HandlerContext<T>) => R | Promise<R>,\n): InferableHandler<R, T>;\n\n// å®ç°\nexport function createHandler<const T extends RouteSchema, R>(\n  schemaOrHandler: T | ((ctx: EmptySchemaContext) => R | Promise<R>),\n  maybeHandler?: (ctx: HandlerContext<T>) => R | Promise<R>,\n): InferableHandler<R, T> {\n  // åˆ¤æ–­è°ƒç”¨æ–¹å¼\n  const hasSchema = !isHandler(schemaOrHandler);\n  const schema = hasSchema ? (schemaOrHandler as T) : ({} as T);\n  const handler = hasSchema\n    ? maybeHandler!\n    : (schemaOrHandler as (ctx: HandlerContext<T>) => R | Promise<R>);\n\n  // é¢„ç¼–è¯‘ schema\n  if (\n    schema.body ||\n    schema.query ||\n    schema.params ||\n    schema.headers ||\n    schema.cookies\n  ) {\n    precompileSchemas(schema);\n  }\n\n  const handlerFn = async (req: Request): Promise<Response> => {\n    try {\n      // è§£æè¯·æ±‚æ•°æ®\n      const query = parseQuery(req);\n      const headers = parseHeaders(req);\n      const cookies = parseCookies(req);\n      const params =\n        ((req as unknown as Record<string, unknown>).params as Record<\n          string,\n          string\n        >) || {};\n\n      // è§£æè¯·æ±‚ä½“\n      let body: unknown = undefined;\n      if (req.method !== \"GET\" && req.method !== \"HEAD\") {\n        const [, parsedBody] = await goAwait(parseBody(req));\n        body = parsedBody;\n      }\n\n      // éªŒè¯ schema\n      const data = { body, query, params, headers, cookies };\n      if (\n        schema.body ||\n        schema.query ||\n        schema.params ||\n        schema.headers ||\n        schema.cookies\n      ) {\n        validateAllSchemas(schema, data);\n      }\n\n      // è°ƒç”¨ handler\n      const result = await handler({\n        req,\n        body: body as HandlerContext<T>[\"body\"],\n        query: query as HandlerContext<T>[\"query\"],\n        params: params as HandlerContext<T>[\"params\"],\n        headers: headers as HandlerContext<T>[\"headers\"],\n        cookies: cookies as HandlerContext<T>[\"cookies\"],\n      });\n\n      return autoResponse(result);\n    } catch (error) {\n      if (error instanceof Error && error.message.includes(\"éªŒè¯å¤±è´¥\")) {\n        return handleValidationError(error);\n      }\n      return handleInternalError(error);\n    }\n  };\n\n  // ç±»å‹æ–­è¨€ï¼šè¿™äº›å±æ€§åªåœ¨ç¼–è¯‘æ—¶ç”¨äºç±»å‹æ¨æ–­ï¼Œè¿è¡Œæ—¶ä¸å­˜åœ¨\n  return handlerFn as InferableHandler<R, T>;\n}\n\n/**\n * åˆ›å»ºå¸¦é¢å¤–ä¸Šä¸‹æ–‡çš„è·¯ç”±å¤„ç†å™¨\n *\n * ç”¨äºä¸­é—´ä»¶æ³¨å…¥é¢å¤–æ•°æ®çš„åœºæ™¯\n *\n * @example\n * ```typescript\n * // å®šä¹‰ä¸­é—´ä»¶æ³¨å…¥çš„ç±»å‹\n * type AuthContext = { user: { id: string; role: string } };\n *\n * // æ—  schema\n * createHandlerWithExtra<AuthContext>(({ user }) => {\n *   return { userId: user.id };\n * })\n *\n * // æœ‰ schema\n * createHandlerWithExtra<AuthContext>(\n *   { body: Type.Object({ action: Type.String() }) },\n *   ({ body, user }) => ({ success: true, userId: user.id })\n * )\n * ```\n */\n// é‡è½½ 1: æ—  schema\nexport function createHandlerWithExtra<\n  TExtra extends Record<string, unknown> = Record<string, never>,\n  R = unknown,\n>(\n  handler: (ctx: EmptySchemaContext & TExtra) => R | Promise<R>,\n): (req: Request) => Promise<Response>;\n\n// é‡è½½ 2: æœ‰ schema\nexport function createHandlerWithExtra<\n  TExtra extends Record<string, unknown> = Record<string, never>,\n  const T extends RouteSchema = RouteSchema,\n  R = unknown,\n>(\n  schema: T,\n  handler: (ctx: HandlerContextWithExtra<T, TExtra>) => R | Promise<R>,\n): (req: Request) => Promise<Response>;\n\n// å®ç°\nexport function createHandlerWithExtra<\n  TExtra extends Record<string, unknown> = Record<string, never>,\n  const T extends RouteSchema = RouteSchema,\n  R = unknown,\n>(\n  schemaOrHandler: T | ((ctx: EmptySchemaContext & TExtra) => R | Promise<R>),\n  maybeHandler?: (ctx: HandlerContextWithExtra<T, TExtra>) => R | Promise<R>,\n): (req: Request) => Promise<Response> {\n  // åˆ¤æ–­è°ƒç”¨æ–¹å¼\n  const hasSchema = !isHandler(schemaOrHandler);\n  const schema = hasSchema ? (schemaOrHandler as T) : ({} as T);\n  const handler = hasSchema\n    ? maybeHandler!\n    : (schemaOrHandler as (\n        ctx: HandlerContextWithExtra<T, TExtra>,\n      ) => R | Promise<R>);\n\n  // é¢„ç¼–è¯‘ schema\n  if (\n    schema.body ||\n    schema.query ||\n    schema.params ||\n    schema.headers ||\n    schema.cookies\n  ) {\n    precompileSchemas(schema);\n  }\n\n  return async (req: Request): Promise<Response> => {\n    try {\n      // è§£æè¯·æ±‚æ•°æ®\n      const query = parseQuery(req);\n      const headers = parseHeaders(req);\n      const cookies = parseCookies(req);\n      const params =\n        ((req as unknown as Record<string, unknown>).params as Record<\n          string,\n          string\n        >) || {};\n\n      // è§£æè¯·æ±‚ä½“\n      let body: unknown = undefined;\n      if (req.method !== \"GET\" && req.method !== \"HEAD\") {\n        const [, parsedBody] = await goAwait(parseBody(req));\n        body = parsedBody;\n      }\n\n      // éªŒè¯ schema\n      const data = { body, query, params, headers, cookies };\n      if (\n        schema.body ||\n        schema.query ||\n        schema.params ||\n        schema.headers ||\n        schema.cookies\n      ) {\n        validateAllSchemas(schema, data);\n      }\n\n      // è·å–ä¸­é—´ä»¶æ³¨å…¥çš„é¢å¤–æ•°æ®\n      const extras = ((req as unknown as Record<string, unknown>).__locals ??\n        {}) as TExtra;\n\n      // è°ƒç”¨ handler\n      const result = await handler({\n        req,\n        body: body as HandlerContext<T>[\"body\"],\n        query: query as HandlerContext<T>[\"query\"],\n        params: params as HandlerContext<T>[\"params\"],\n        headers: headers as HandlerContext<T>[\"headers\"],\n        cookies: cookies as HandlerContext<T>[\"cookies\"],\n        ...extras,\n      } as HandlerContextWithExtra<T, TExtra>);\n\n      return autoResponse(result);\n    } catch (error) {\n      if (error instanceof Error && error.message.includes(\"éªŒè¯å¤±è´¥\")) {\n        return handleValidationError(error);\n      }\n      return handleInternalError(error);\n    }\n  };\n}\n\n/**\n * ç®€å•çš„è·¯ç”±å¤„ç†å™¨ (æ—  schema éªŒè¯ï¼Œåªæœ‰ req)\n *\n * @example\n * ```typescript\n * simpleHandler(({ req }) => {\n *   return { message: \"Hello World\" };\n * })\n * ```\n */\nexport function simpleHandler<R>(\n  handler: (ctx: { req: Request }) => R | Promise<R>,\n): (req: Request) => Promise<Response> {\n  return async (req: Request): Promise<Response> => {\n    try {\n      const result = await handler({ req });\n      return autoResponse(result);\n    } catch (error) {\n      return handleInternalError(error);\n    }\n  };\n}\n","export function base64urlEncode(str: string): string {\n  return btoa(str)\n    .replace(/=/g, \"\") // âœ… åˆ é™¤å¡«å……\n    .replace(/\\+/g, \"-\")\n    .replace(/\\//g, \"_\");\n}\n\nexport function base64urlDecode(str: string): string {\n  const pad = str.length % 4 === 0 ? \"\" : \"=\".repeat(4 - (str.length % 4));\n  const base64 = str.replace(/-/g, \"+\").replace(/_/g, \"/\") + pad;\n  return atob(base64);\n}\n","import { parseCookies } from \"./parsers\";\n\n/** è·å–å•ä¸ª Cookie å€¼ */\nexport function getCookie(req: Request, key: string): string | null {\n  const cookies = parseCookies(req);\n  return cookies[key] || null;\n}\n\n/** ç”Ÿæˆ Set-Cookie å¤´ */\nexport function setCookie(\n  key: string,\n  value: string,\n  options: {\n    path?: string;\n    httpOnly?: boolean;\n    maxAge?: number;\n    secure?: boolean;\n  } = {},\n): string {\n  let cookie = `${key}=${encodeURIComponent(value)}`;\n\n  if (options.path) cookie += `; Path=${options.path}`;\n  if (options.httpOnly) cookie += `; HttpOnly`;\n  if (options.secure) cookie += `; Secure`;\n  if (options.maxAge) cookie += `; Max-Age=${options.maxAge}`;\n\n  return cookie;\n}\n\n// æä¾›ç»™ä¸­é—´ä»¶å†™å…¥\"å±€éƒ¨ä¸Šä¸‹æ–‡\"çš„å·¥å…·å‡½æ•°\nexport function setLocals<T extends object>(req: Request, extras: T) {\n  const target = req as unknown as Record<string, unknown>;\n  target.__locals = { ...((target.__locals as object) ?? {}), ...extras };\n}\n\n// è·å–ä¸­é—´ä»¶æ³¨å…¥çš„å±€éƒ¨ä¸Šä¸‹æ–‡\nexport function getLocals<T extends object>(req: Request): T {\n  const target = req as unknown as Record<string, unknown>;\n  return (target.__locals ?? {}) as T;\n}\n","/**\n * è¯·æ±‚è§£æå’ŒéªŒè¯å™¨\n *\n * è§£æhandlerçš„reqå‚æ•°ï¼Œä½¿ç”¨UltraéªŒè¯å™¨è¿›è¡ŒéªŒè¯ï¼Œ\n * å¹¶ç±»å‹å®‰å…¨åœ°è¿”å›è§£æå‡ºæ¥çš„å€¼\n *\n * @author Framework Team\n * @version 1.0.0\n * @license MIT\n */\n\nimport type { TSchema } from \"@sinclair/typebox\";\nimport type { Static } from \"@sinclair/typebox\";\nimport {\n  validateAllSchemas,\n  type SchemaConfig,\n} from \"./validators/validators\";\nimport { parseBody, parseQuery, parseHeaders, parseCookies } from \"./parsers\";\n\n// è¯·æ±‚æ•°æ®ç»“æ„\nexport interface RequestData {\n  body: unknown;\n  query: unknown;\n  params: Record<string, string>;\n  headers: Record<string, string>;\n  cookies: Record<string, string>;\n}\n\n// éªŒè¯åçš„è¯·æ±‚æ•°æ®ç±»å‹\nexport interface ValidatedRequestData<T extends SchemaConfig> {\n  body: T[\"body\"] extends TSchema ? Static<T[\"body\"]> : unknown;\n  query: T[\"query\"] extends TSchema ? Static<T[\"query\"]> : unknown;\n  params: T[\"params\"] extends TSchema\n    ? Static<T[\"params\"]>\n    : Record<string, string>;\n  headers: T[\"headers\"] extends TSchema\n    ? Static<T[\"headers\"]>\n    : Record<string, string>;\n  cookies: T[\"cookies\"] extends TSchema\n    ? Static<T[\"cookies\"]>\n    : Record<string, string>;\n}\n\n// éªŒè¯ç»“æœ\nexport interface ValidationResult<T extends SchemaConfig> {\n  success: boolean;\n  data?: ValidatedRequestData<T>;\n  errors?: Array<{ field: keyof SchemaConfig; message: string }>;\n}\n\n/**\n * è§£æRequestå¯¹è±¡ï¼Œæå–æ‰€æœ‰ç›¸å…³æ•°æ®\n * @param request Requestå¯¹è±¡\n * @param params è·¯å¾„å‚æ•°ï¼ˆå¯é€‰ï¼‰\n * @returns è§£æåçš„è¯·æ±‚æ•°æ®\n */\nexport async function parseRequest(\n  request: Request,\n  params?: Record<string, string>,\n): Promise<RequestData> {\n  const requestData: RequestData = {\n    body: undefined,\n    query: parseQuery(request),\n    params: params || {},\n    headers: parseHeaders(request),\n    cookies: parseCookies(request),\n  };\n\n  // å¯¹äºéGETè¯·æ±‚ï¼Œå°è¯•è§£æè¯·æ±‚ä½“\n  if (request.method !== \"GET\" && request.method !== \"HEAD\") {\n    requestData.body = await parseBody(request);\n  }\n\n  return requestData;\n}\n\n/**\n * éªŒè¯è¯·æ±‚æ•°æ®\n * @param config Schemaé…ç½®\n * @param requestData è¯·æ±‚æ•°æ®\n * @returns éªŒè¯ç»“æœ\n */\nexport function validateRequest<T extends SchemaConfig>(\n  config: T,\n  requestData: RequestData,\n): ValidationResult<T> {\n  try {\n    const validatedData = validateAllSchemas(config, requestData);\n\n    return {\n      success: true,\n      data: validatedData as ValidatedRequestData<T>,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      errors: [\n        {\n          field: \"unknown\" as keyof SchemaConfig,\n          message: error instanceof Error ? error.message : \"éªŒè¯å¤±è´¥\",\n        },\n      ],\n    };\n  }\n}\n\n/**\n * å®Œæ•´çš„è¯·æ±‚è§£æå’ŒéªŒè¯æµç¨‹\n * @param request Requestå¯¹è±¡\n * @param config Schemaé…ç½®\n * @param params è·¯å¾„å‚æ•°ï¼ˆå¯é€‰ï¼‰\n * @returns éªŒè¯ç»“æœ\n */\nexport async function parseAndValidateRequest<T extends SchemaConfig>(\n  request: Request,\n  config: T,\n  params?: Record<string, string>,\n): Promise<ValidationResult<T>> {\n  try {\n    // 1. è§£æè¯·æ±‚\n    const requestData = await parseRequest(request, params);\n\n    // 2. éªŒè¯æ•°æ®\n    return validateRequest(config, requestData);\n  } catch (error) {\n    return {\n      success: false,\n      errors: [\n        {\n          field: \"unknown\" as keyof SchemaConfig,\n          message: error instanceof Error ? error.message : \"è¯·æ±‚è§£æå¤±è´¥\",\n        },\n      ],\n    };\n  }\n}\n\n/**\n * åˆ›å»ºç±»å‹å®‰å…¨çš„è¯·æ±‚éªŒè¯å™¨å·¥å‚\n * @param config Schemaé…ç½®\n * @returns éªŒè¯å™¨å‡½æ•°\n */\nexport function createRequestValidator<T extends SchemaConfig>(config: T) {\n  return async (request: Request, params?: Record<string, string>) => {\n    return parseAndValidateRequest(request, config, params);\n  };\n}\n","/**\n * HTMLæ¸²æŸ“å·¥å…·ç±»\n * æä¾›ç»Ÿä¸€çš„HTMLæ¨¡æ¿ç”ŸæˆåŠŸèƒ½\n */\nexport class HtmlRenderer {\n  /**\n   * ç”ŸæˆåŸºç¡€HTMLæ¨¡æ¿\n   */\n  static generateBaseHtml(\n    content: string,\n    context: any,\n    clientScriptPath: string = \"/client.js\",\n  ): string {\n    return `\n      <!doctype html>\n      <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <title>Vafast SSR App</title>\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        </head>\n        <body>\n          <div id=\"app\">${content}</div>\n          <script>\n            window.__ROUTE_INFO__ = {\n              params: ${JSON.stringify(context.params || {})},\n              query: ${JSON.stringify(context.query || {})},\n              pathname: '${context.pathname}'\n            };\n          </script>\n          <script type=\"module\" src=\"${clientScriptPath}\"></script>\n        </body>\n      </html>\n    `;\n  }\n\n  /**\n   * ç”ŸæˆVueç»„ä»¶HTML\n   */\n  static generateVueHtml(\n    content: string,\n    context: any,\n    clientScriptPath: string = \"/client.js\",\n  ): string {\n    return this.generateBaseHtml(content, context, clientScriptPath);\n  }\n\n  /**\n   * ç”ŸæˆReactç»„ä»¶HTML\n   */\n  static generateReactHtml(\n    content: string,\n    context: any,\n    clientScriptPath: string = \"/client.js\",\n  ): string {\n    return `\n      <!doctype html>\n      <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <title>Vafast SSR App</title>\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        </head>\n        <body>\n          <div id=\"root\">${content}</div>\n          <script>\n            window.__ROUTE_INFO__ = {\n              params: ${JSON.stringify(context.params || {})},\n              query: ${JSON.stringify(context.query || {})},\n              pathname: '${context.pathname}'\n            };\n          </script>\n          <script type=\"module\" src=\"${clientScriptPath}\"></script>\n        </body>\n      </html>\n    `;\n  }\n}\n","/**\n * ä¾èµ–ç®¡ç†å™¨\n * è´Ÿè´£æŒ‰éœ€åŠ è½½å’Œç®¡ç†æ¡†æ¶ä¾èµ–\n */\nexport class DependencyManager {\n  private dependencyCache = new Map<string, any>();\n\n  /**\n   * æŒ‰éœ€è·å–æ¡†æ¶ä¾èµ–\n   */\n  async getFrameworkDeps(framework: \"vue\" | \"react\") {\n    if (this.dependencyCache.has(framework)) {\n      return this.dependencyCache.get(framework);\n    }\n\n    console.log(`ğŸ“¦ æŒ‰éœ€åŠ è½½ ${framework} ä¾èµ–...`);\n\n    try {\n      let deps;\n      switch (framework) {\n        case \"vue\":\n          deps = await Promise.all([\n            import(\"vue\"),\n            import(\"@vue/server-renderer\"),\n          ]);\n          break;\n        case \"react\":\n          deps = await Promise.all([\n            import(\"react\"),\n            import(\"react-dom/server\"),\n          ]);\n          break;\n        default:\n          throw new Error(`ä¸æ”¯æŒçš„æ¡†æ¶: ${framework}`);\n      }\n\n      this.dependencyCache.set(framework, deps);\n      console.log(`âœ… ${framework} ä¾èµ–åŠ è½½å®Œæˆ`);\n      return deps;\n    } catch (error) {\n      console.error(`âŒ ${framework} ä¾èµ–åŠ è½½å¤±è´¥:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * æ£€æµ‹ç»„ä»¶ç±»å‹\n   */\n  detectComponentType(component: any): \"vue\" | \"react\" {\n    // ç®€å•çš„ç»„ä»¶ç±»å‹æ£€æµ‹\n    if (component.render && typeof component.render === \"function\") {\n      return \"vue\";\n    }\n    if (component.$$typeof) {\n      return \"react\";\n    }\n    // é»˜è®¤ä½¿ç”¨ Vue\n    return \"vue\";\n  }\n\n  /**\n   * æ¸…é™¤ç¼“å­˜\n   */\n  clearCache(): void {\n    this.dependencyCache.clear();\n    console.log(\"ğŸ§¹ ä¾èµ–ç¼“å­˜å·²æ¸…é™¤\");\n  }\n\n  /**\n   * è·å–ç¼“å­˜çŠ¶æ€\n   */\n  getCacheStatus(): Record<string, boolean> {\n    const status: Record<string, boolean> = {};\n    for (const [framework] of this.dependencyCache) {\n      status[framework] = true;\n    }\n    return status;\n  }\n}\n","/**\n * TypeBox Format éªŒè¯å™¨\n *\n * å†…ç½®å¸¸ç”¨çš„ format éªŒè¯ï¼Œå¯¹æ ‡ Zod çš„å†…ç½®éªŒè¯\n * æ¡†æ¶å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†Œ\n *\n * @version 1.0.0\n */\n\nimport { FormatRegistry } from \"@sinclair/typebox\";\n\n// ============== æ­£åˆ™è¡¨è¾¾å¼ ==============\n\n// é‚®ç®± (RFC 5322 ç®€åŒ–ç‰ˆ)\nconst EMAIL_REGEX = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n\n// UUID v4\nconst UUID_REGEX = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n\n// UUID ä»»æ„ç‰ˆæœ¬\nconst UUID_ANY_REGEX = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n\n// CUID\nconst CUID_REGEX = /^c[^\\s-]{8,}$/i;\n\n// CUID2\nconst CUID2_REGEX = /^[0-9a-z]+$/;\n\n// ULID\nconst ULID_REGEX = /^[0-9A-HJKMNP-TV-Z]{26}$/i;\n\n// NanoID (é»˜è®¤ 21 å­—ç¬¦)\nconst NANOID_REGEX = /^[A-Za-z0-9_-]{21}$/;\n\n// URL\nconst URL_REGEX = /^https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b[-a-zA-Z0-9()@:%_+.~#?&/=]*$/;\n\n// IPv4\nconst IPV4_REGEX = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\n\n// IPv6 (ç®€åŒ–ç‰ˆ)\nconst IPV6_REGEX = /^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$|^::(?:[0-9a-fA-F]{1,4}:){0,6}[0-9a-fA-F]{1,4}$|^(?:[0-9a-fA-F]{1,4}:){1,7}:$|^(?:[0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}$|^(?:[0-9a-fA-F]{1,4}:){1,5}(?::[0-9a-fA-F]{1,4}){1,2}$|^(?:[0-9a-fA-F]{1,4}:){1,4}(?::[0-9a-fA-F]{1,4}){1,3}$|^(?:[0-9a-fA-F]{1,4}:){1,3}(?::[0-9a-fA-F]{1,4}){1,4}$|^(?:[0-9a-fA-F]{1,4}:){1,2}(?::[0-9a-fA-F]{1,4}){1,5}$|^[0-9a-fA-F]{1,4}:(?::[0-9a-fA-F]{1,4}){1,6}$/;\n\n// CIDR (IPv4)\nconst CIDR_REGEX = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\/(?:3[0-2]|[12]?[0-9])$/;\n\n// æ—¥æœŸ (YYYY-MM-DD)\nconst DATE_REGEX = /^\\d{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12][0-9]|3[01])$/;\n\n// æ—¶é—´ (HH:mm:ss æˆ– HH:mm:ss.SSS)\nconst TIME_REGEX = /^(?:[01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9](?:\\.\\d{1,3})?$/;\n\n// ISO æ—¥æœŸæ—¶é—´\nconst DATE_TIME_REGEX = /^\\d{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12][0-9]|3[01])T(?:[01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9](?:\\.\\d{1,3})?(?:Z|[+-](?:[01][0-9]|2[0-3]):[0-5][0-9])?$/;\n\n// ISO 8601 Duration (P1Y2M3DT4H5M6S)\nconst DURATION_REGEX = /^P(?:\\d+Y)?(?:\\d+M)?(?:\\d+W)?(?:\\d+D)?(?:T(?:\\d+H)?(?:\\d+M)?(?:\\d+(?:\\.\\d+)?S)?)?$/;\n\n// Hostname (RFC 1123)\nconst HOSTNAME_REGEX = /^(?=.{1,253}$)(?:(?!-)[a-zA-Z0-9-]{1,63}(?<!-)\\.)*(?!-)[a-zA-Z0-9-]{1,63}(?<!-)$/;\n\n// æ‰‹æœºå· (ä¸­å›½å¤§é™†)\nconst PHONE_CN_REGEX = /^1[3-9]\\d{9}$/;\n\n// æ‰‹æœºå· (å›½é™…æ ¼å¼ E.164)\nconst PHONE_E164_REGEX = /^\\+[1-9]\\d{6,14}$/;\n\n// MongoDB ObjectId\nconst OBJECTID_REGEX = /^[0-9a-fA-F]{24}$/;\n\n// åå…­è¿›åˆ¶é¢œè‰²\nconst HEX_COLOR_REGEX = /^#(?:[0-9a-fA-F]{3}){1,2}$/;\n\n// RGB/RGBA é¢œè‰²\nconst RGB_COLOR_REGEX = /^rgba?\\(\\s*(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\s*,\\s*(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\s*,\\s*(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(?:\\s*,\\s*(?:0|1|0?\\.\\d+))?\\s*\\)$/;\n\n// Base64\nconst BASE64_REGEX = /^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/;\n\n// Base64 URL Safe\nconst BASE64URL_REGEX = /^[A-Za-z0-9_-]+$/;\n\n// JWT (3 éƒ¨åˆ† base64url)\nconst JWT_REGEX = /^[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+$/;\n\n// Emoji (ç®€åŒ–æ£€æµ‹)\nconst EMOJI_REGEX = /^[\\p{Emoji}]+$/u;\n\n// Slug (URL å‹å¥½å­—ç¬¦ä¸²)\nconst SLUG_REGEX = /^[a-z0-9]+(?:-[a-z0-9]+)*$/;\n\n// Semver (è¯­ä¹‰åŒ–ç‰ˆæœ¬)\nconst SEMVER_REGEX = /^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$/;\n\n// ä¿¡ç”¨å¡å· (Luhn ç®—æ³•éªŒè¯)\nfunction isValidCreditCard(value: string): boolean {\n  const digits = value.replace(/\\D/g, \"\");\n  if (digits.length < 13 || digits.length > 19) return false;\n\n  let sum = 0;\n  let isEven = false;\n  for (let i = digits.length - 1; i >= 0; i--) {\n    let digit = parseInt(digits[i], 10);\n    if (isEven) {\n      digit *= 2;\n      if (digit > 9) digit -= 9;\n    }\n    sum += digit;\n    isEven = !isEven;\n  }\n  return sum % 10 === 0;\n}\n\n// ============== Format æ³¨å†Œ ==============\n\nlet isRegistered = false;\n\n/**\n * æ³¨å†Œæ‰€æœ‰å†…ç½® format éªŒè¯å™¨\n * æ¡†æ¶è‡ªåŠ¨è°ƒç”¨ï¼Œä¹Ÿå¯æ‰‹åŠ¨è°ƒç”¨\n */\nexport function registerFormats(): void {\n  if (isRegistered) return;\n  isRegistered = true;\n\n  // === å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ ===\n  FormatRegistry.Set(\"email\", (v) => EMAIL_REGEX.test(v));\n  FormatRegistry.Set(\"uuid\", (v) => UUID_REGEX.test(v));\n  FormatRegistry.Set(\"uuid-any\", (v) => UUID_ANY_REGEX.test(v));\n  FormatRegistry.Set(\"cuid\", (v) => CUID_REGEX.test(v));\n  FormatRegistry.Set(\"cuid2\", (v) => CUID2_REGEX.test(v) && v.length >= 1);\n  FormatRegistry.Set(\"ulid\", (v) => ULID_REGEX.test(v));\n  FormatRegistry.Set(\"nanoid\", (v) => NANOID_REGEX.test(v));\n  FormatRegistry.Set(\"objectid\", (v) => OBJECTID_REGEX.test(v));\n  FormatRegistry.Set(\"slug\", (v) => SLUG_REGEX.test(v));\n\n  // === ç½‘ç»œç›¸å…³ ===\n  FormatRegistry.Set(\"url\", (v) => URL_REGEX.test(v));\n  FormatRegistry.Set(\"uri\", (v) => URL_REGEX.test(v)); // åˆ«å\n  FormatRegistry.Set(\"ipv4\", (v) => IPV4_REGEX.test(v));\n  FormatRegistry.Set(\"ipv6\", (v) => IPV6_REGEX.test(v));\n  FormatRegistry.Set(\"ip\", (v) => IPV4_REGEX.test(v) || IPV6_REGEX.test(v));\n  FormatRegistry.Set(\"cidr\", (v) => CIDR_REGEX.test(v));\n  FormatRegistry.Set(\"hostname\", (v) => HOSTNAME_REGEX.test(v));\n\n  // === æ—¥æœŸæ—¶é—´ ===\n  FormatRegistry.Set(\"date\", (v) => DATE_REGEX.test(v));\n  FormatRegistry.Set(\"time\", (v) => TIME_REGEX.test(v));\n  FormatRegistry.Set(\"date-time\", (v) => DATE_TIME_REGEX.test(v));\n  FormatRegistry.Set(\"datetime\", (v) => DATE_TIME_REGEX.test(v)); // åˆ«å\n  FormatRegistry.Set(\"duration\", (v) => DURATION_REGEX.test(v));\n\n  // === æ‰‹æœºå· ===\n  FormatRegistry.Set(\"phone\", (v) => PHONE_CN_REGEX.test(v)); // ä¸­å›½å¤§é™†\n  FormatRegistry.Set(\"phone-cn\", (v) => PHONE_CN_REGEX.test(v));\n  FormatRegistry.Set(\"phone-e164\", (v) => PHONE_E164_REGEX.test(v)); // å›½é™…\n\n  // === ç¼–ç æ ¼å¼ ===\n  FormatRegistry.Set(\"base64\", (v) => BASE64_REGEX.test(v));\n  FormatRegistry.Set(\"base64url\", (v) => BASE64URL_REGEX.test(v));\n  FormatRegistry.Set(\"jwt\", (v) => JWT_REGEX.test(v));\n\n  // === é¢œè‰² ===\n  FormatRegistry.Set(\"hex-color\", (v) => HEX_COLOR_REGEX.test(v));\n  FormatRegistry.Set(\"rgb-color\", (v) => RGB_COLOR_REGEX.test(v));\n  FormatRegistry.Set(\n    \"color\",\n    (v) => HEX_COLOR_REGEX.test(v) || RGB_COLOR_REGEX.test(v),\n  );\n\n  // === å…¶ä»– ===\n  FormatRegistry.Set(\"emoji\", (v) => EMOJI_REGEX.test(v));\n  FormatRegistry.Set(\"semver\", (v) => SEMVER_REGEX.test(v));\n  FormatRegistry.Set(\"credit-card\", isValidCreditCard);\n}\n\n/**\n * è‡ªå®šä¹‰æ³¨å†Œ format\n */\nexport function registerFormat(\n  name: string,\n  validator: (value: string) => boolean,\n): void {\n  FormatRegistry.Set(name, validator);\n}\n\n/**\n * æ£€æŸ¥ format æ˜¯å¦å·²æ³¨å†Œ\n */\nexport function hasFormat(name: string): boolean {\n  return FormatRegistry.Has(name);\n}\n\n// å¯¼å‡ºæ­£åˆ™ï¼ˆä¾›å¤–éƒ¨ä½¿ç”¨ï¼‰\nexport const Patterns = {\n  EMAIL: EMAIL_REGEX,\n  UUID: UUID_REGEX,\n  URL: URL_REGEX,\n  IPV4: IPV4_REGEX,\n  IPV6: IPV6_REGEX,\n  DATE: DATE_REGEX,\n  TIME: TIME_REGEX,\n  DATE_TIME: DATE_TIME_REGEX,\n  PHONE_CN: PHONE_CN_REGEX,\n  PHONE_E164: PHONE_E164_REGEX,\n  OBJECTID: OBJECTID_REGEX,\n  HEX_COLOR: HEX_COLOR_REGEX,\n  SLUG: SLUG_REGEX,\n  SEMVER: SEMVER_REGEX,\n  JWT: JWT_REGEX,\n} as const;\n\n","/**\n * Server-Sent Events (SSE) æ”¯æŒ\n *\n * ç”¨äºå®ç°æµå¼å“åº”ï¼Œå¦‚ AI èŠå¤©ã€å®æ—¶é€šçŸ¥ç­‰\n *\n * @example\n * ```typescript\n * import { createSSEHandler, Type } from 'vafast'\n *\n * const streamHandler = createSSEHandler(\n *   { query: Type.Object({ prompt: Type.String() }) },\n *   async function* ({ query }) {\n *     yield { event: 'start', data: { message: 'Starting...' } }\n *\n *     for await (const chunk of aiStream(query.prompt)) {\n *       yield { data: chunk }\n *     }\n *\n *     yield { event: 'end', data: { message: 'Done!' } }\n *   }\n * )\n * ```\n */\n\nimport type { RouteSchema, HandlerContext } from \"../types/schema\";\nimport { parseQuery, parseHeaders, parseCookies } from \"./parsers\";\nimport { precompileSchemas, validateAllSchemas } from \"./validators/validators\";\n\n/**\n * SSE äº‹ä»¶ç±»å‹\n */\nexport interface SSEEvent<T = unknown> {\n  /** äº‹ä»¶åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º messageï¼‰ */\n  event?: string;\n  /** äº‹ä»¶æ•°æ® */\n  data: T;\n  /** äº‹ä»¶ IDï¼ˆå¯é€‰ï¼‰ */\n  id?: string;\n  /** é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼Œå¯é€‰ï¼‰ */\n  retry?: number;\n}\n\n/**\n * SSE ç”Ÿæˆå™¨å‡½æ•°ç±»å‹\n */\nexport type SSEGenerator<T extends RouteSchema = RouteSchema> = (\n  ctx: HandlerContext<T>\n) => AsyncGenerator<SSEEvent<unknown>, void, unknown>;\n\n/**\n * æ ¼å¼åŒ– SSE äº‹ä»¶ä¸ºå­—ç¬¦ä¸²\n */\nfunction formatSSEEvent(event: SSEEvent): string {\n  const lines: string[] = [];\n\n  if (event.id !== undefined) {\n    lines.push(`id: ${event.id}`);\n  }\n\n  if (event.event !== undefined) {\n    lines.push(`event: ${event.event}`);\n  }\n\n  if (event.retry !== undefined) {\n    lines.push(`retry: ${event.retry}`);\n  }\n\n  // æ•°æ®å¯èƒ½æ˜¯å¤šè¡Œçš„ï¼Œéœ€è¦åˆ†è¡Œå¤„ç†\n  const dataStr = typeof event.data === 'string'\n    ? event.data\n    : JSON.stringify(event.data);\n\n  const dataLines = dataStr.split('\\n');\n  for (const line of dataLines) {\n    lines.push(`data: ${line}`);\n  }\n\n  return lines.join('\\n') + '\\n\\n';\n}\n\n/**\n * SSE æ ‡è®°ç±»å‹ - ä½¿ç”¨å­—é¢é‡å“ç‰Œç±»å‹\n */\nexport type SSEMarker = { readonly __brand: 'SSE' }\n\n/**\n * SSE Handler ç±»å‹æ ‡è®°\n */\nexport interface SSEHandler<TSchema extends RouteSchema = RouteSchema> {\n  (req: Request): Promise<Response>;\n  /** è¿”å›ç±»å‹æ ‡è®° - SSE æµçš„æ•°æ®ç±»å‹ */\n  readonly __returnType: unknown;\n  /** Schema ç±»å‹æ ‡è®° */\n  readonly __schema: TSchema;\n  /** SSE æ ‡è®° - ä½¿ç”¨å“ç‰Œç±»å‹ç¡®ä¿ä¸è¢«æ‰©å±• */\n  readonly __sse: SSEMarker;\n}\n\n/**\n * åˆ›å»º SSE æµå¼å“åº”å¤„ç†å™¨\n *\n * @example\n * ```typescript\n * // åŸºç¡€ç”¨æ³•\n * const streamChat = createSSEHandler(\n *   { query: Type.Object({ message: Type.String() }) },\n *   async function* ({ query }) {\n *     const response = await ai.chat(query.message);\n *\n *     for await (const chunk of response) {\n *       yield { data: { text: chunk } };\n *     }\n *   }\n * );\n *\n * // ä½¿ç”¨è·¯ç”±\n * route('GET', '/chat/stream', streamChat)\n * ```\n */\nexport function createSSEHandler<const T extends RouteSchema>(\n  schema: T,\n  generator: SSEGenerator<T>\n): SSEHandler<T>;\n\nexport function createSSEHandler(\n  generator: SSEGenerator<RouteSchema>\n): SSEHandler<RouteSchema>;\n\nexport function createSSEHandler<const T extends RouteSchema>(\n  schemaOrGenerator: T | SSEGenerator<T>,\n  maybeGenerator?: SSEGenerator<T>\n): SSEHandler<T> {\n  // åˆ¤æ–­è°ƒç”¨æ–¹å¼\n  const hasSchema = typeof schemaOrGenerator !== 'function';\n  const schema = hasSchema ? (schemaOrGenerator as T) : ({} as T);\n  const generator = hasSchema\n    ? maybeGenerator!\n    : (schemaOrGenerator as SSEGenerator<T>);\n\n  // é¢„ç¼–è¯‘ schema\n  if (schema.body || schema.query || schema.params || schema.headers || schema.cookies) {\n    precompileSchemas(schema);\n  }\n\n  const handlerFn = async (req: Request): Promise<Response> => {\n    try {\n      // è§£æè¯·æ±‚æ•°æ®\n      const query = parseQuery(req);\n      const headers = parseHeaders(req);\n      const cookies = parseCookies(req);\n      const params = ((req as unknown as Record<string, unknown>).params as Record<string, string>) || {};\n\n      // éªŒè¯ schema\n      const data = { body: undefined, query, params, headers, cookies };\n      if (schema.body || schema.query || schema.params || schema.headers || schema.cookies) {\n        validateAllSchemas(schema, data);\n      }\n\n      // åˆ›å»º SSE æµ\n      const stream = new ReadableStream({\n        async start(controller) {\n          const encoder = new TextEncoder();\n\n          try {\n            const gen = generator({\n              req,\n              body: undefined as HandlerContext<T>['body'],\n              query: query as HandlerContext<T>['query'],\n              params: params as HandlerContext<T>['params'],\n              headers: headers as HandlerContext<T>['headers'],\n              cookies: cookies as HandlerContext<T>['cookies'],\n            });\n\n            for await (const event of gen) {\n              const formatted = formatSSEEvent(event);\n              controller.enqueue(encoder.encode(formatted));\n            }\n          } catch (error) {\n            // å‘é€é”™è¯¯äº‹ä»¶\n            const errorEvent = formatSSEEvent({\n              event: 'error',\n              data: {\n                message: error instanceof Error ? error.message : 'Unknown error'\n              }\n            });\n            controller.enqueue(encoder.encode(errorEvent));\n          } finally {\n            controller.close();\n          }\n        }\n      });\n\n      return new Response(stream, {\n        headers: {\n          'Content-Type': 'text/event-stream',\n          'Cache-Control': 'no-cache',\n          'Connection': 'keep-alive',\n          'X-Accel-Buffering': 'no', // Nginx ç¦ç”¨ç¼“å†²\n        }\n      });\n    } catch (error) {\n      // éªŒè¯é”™è¯¯ç­‰\n      return new Response(\n        JSON.stringify({\n          success: false,\n          error: 'Validation Error',\n          message: error instanceof Error ? error.message : 'Unknown error'\n        }),\n        {\n          status: 400,\n          headers: { 'Content-Type': 'application/json' }\n        }\n      );\n    }\n  };\n\n  // æ·»åŠ ç±»å‹æ ‡è®°\n  const handler = handlerFn as SSEHandler<T>;\n  (handler as unknown as { __sse: SSEMarker }).__sse = { __brand: 'SSE' } as const;\n  (handler as unknown as { __schema: T }).__schema = schema;\n  (handler as unknown as { __returnType: unknown }).__returnType = undefined;\n  return handler;\n}\n\n\n","/**\n * è·¯ç”±æ³¨å†Œè¡¨\n *\n * æä¾›è·¯ç”±å…ƒä¿¡æ¯çš„æ”¶é›†å’ŒæŸ¥è¯¢èƒ½åŠ›\n * å¯ç”¨äºï¼šAPI æ–‡æ¡£ç”Ÿæˆã€Webhook äº‹ä»¶æ³¨å†Œã€æƒé™æ£€æŸ¥ã€å®¡è®¡æ—¥å¿—ç­‰\n *\n * @example\n * ```typescript\n * // åˆ›å»ºæ³¨å†Œè¡¨\n * const registry = createRouteRegistry(server.getRoutes())\n *\n * // æŸ¥è¯¢è·¯ç”±\n * const route = registry.get('POST', '/auth/signIn')\n *\n * // ç­›é€‰æœ‰ webhook é…ç½®çš„è·¯ç”±\n * const webhookRoutes = registry.filter('webhook')\n *\n * // æŒ‰åˆ†ç±»è·å–\n * const authRoutes = registry.getByCategory('auth')\n * ```\n */\n\nimport type { FlattenedRoute, Method } from '../types'\n\n/**\n * è·¯ç”±å…ƒä¿¡æ¯ï¼ˆä¸å« handler å’Œ middlewareï¼‰\n */\nexport interface RouteMeta {\n  method: Method\n  path: string\n  fullPath: string\n  name?: string\n  description?: string\n  /** æ‰©å±•å­—æ®µ */\n  [key: string]: unknown\n}\n\n/**\n * è·¯ç”±æ³¨å†Œè¡¨\n *\n * æ³›å‹ T ç”¨äºå®šä¹‰æ‰©å±•å­—æ®µçš„ç±»å‹\n */\nexport class RouteRegistry<T extends Record<string, unknown> = Record<string, unknown>> {\n  /** æ‰€æœ‰è·¯ç”±å…ƒä¿¡æ¯ */\n  private routes: RouteMeta[] = []\n\n  /** è·¯ç”±æ˜ å°„è¡¨ï¼šMETHOD:fullPath -> RouteMeta */\n  private routeMap = new Map<string, RouteMeta>()\n\n  /** åˆ†ç±»æ˜ å°„è¡¨ï¼šcategory -> RouteMeta[] */\n  private categoryMap = new Map<string, RouteMeta[]>()\n\n  constructor(routes: FlattenedRoute[]) {\n    this.buildRegistry(routes)\n  }\n\n  /**\n   * æ„å»ºæ³¨å†Œè¡¨\n   */\n  private buildRegistry(routes: FlattenedRoute[]): void {\n    for (const route of routes) {\n      // æå–å…ƒä¿¡æ¯ï¼ˆæ’é™¤ handler å’Œ middlewareï¼‰\n      const meta: RouteMeta = {\n        method: route.method,\n        path: route.path,\n        fullPath: route.fullPath,\n        name: route.name,\n        description: route.description,\n      }\n\n      // å¤åˆ¶æ‰©å±•å­—æ®µ\n      for (const key of Object.keys(route)) {\n        if (!['method', 'path', 'fullPath', 'name', 'description', 'handler', 'middleware', 'middlewareChain'].includes(key)) {\n          meta[key] = route[key as keyof FlattenedRoute]\n        }\n      }\n\n      this.routes.push(meta)\n      this.routeMap.set(`${route.method}:${route.fullPath}`, meta)\n\n      // æŒ‰åˆ†ç±»ç´¢å¼•\n      const category = this.extractCategory(route.fullPath)\n      if (!this.categoryMap.has(category)) {\n        this.categoryMap.set(category, [])\n      }\n      this.categoryMap.get(category)!.push(meta)\n    }\n  }\n\n  /**\n   * æå–åˆ†ç±»ï¼ˆç¬¬ä¸€æ®µè·¯å¾„ï¼‰\n   */\n  private extractCategory(path: string): string {\n    const segments = path.split('/').filter(Boolean)\n    return segments[0] || 'root'\n  }\n\n  // ============================================\n  // æŸ¥è¯¢æ¥å£\n  // ============================================\n\n  /**\n   * è·å–æ‰€æœ‰è·¯ç”±å…ƒä¿¡æ¯\n   */\n  getAll(): RouteMeta[] {\n    return [...this.routes]\n  }\n\n  /**\n   * æŒ‰ method + path æŸ¥è¯¢è·¯ç”±\n   */\n  get(method: string, path: string): (RouteMeta & T) | undefined {\n    return this.routeMap.get(`${method}:${path}`) as (RouteMeta & T) | undefined\n  }\n\n  /**\n   * æ£€æŸ¥è·¯ç”±æ˜¯å¦å­˜åœ¨\n   */\n  has(method: string, path: string): boolean {\n    return this.routeMap.has(`${method}:${path}`)\n  }\n\n  /**\n   * æŒ‰åˆ†ç±»è·å–è·¯ç”±\n   */\n  getByCategory(category: string): RouteMeta[] {\n    return this.categoryMap.get(category) || []\n  }\n\n  /**\n   * è·å–æ‰€æœ‰åˆ†ç±»\n   */\n  getCategories(): string[] {\n    return Array.from(this.categoryMap.keys()).sort()\n  }\n\n  /**\n   * ç­›é€‰æœ‰ç‰¹å®šå­—æ®µçš„è·¯ç”±\n   *\n   * @example\n   * ```typescript\n   * // è·å–æ‰€æœ‰é…ç½®äº† webhook çš„è·¯ç”±\n   * const webhookRoutes = registry.filter('webhook')\n   * ```\n   */\n  filter<K extends string>(field: K): (RouteMeta & Record<K, unknown>)[] {\n    return this.routes.filter((r) => field in r && r[field] !== undefined) as (RouteMeta & Record<K, unknown>)[]\n  }\n\n  /**\n   * æŒ‰æ¡ä»¶ç­›é€‰è·¯ç”±\n   *\n   * @example\n   * ```typescript\n   * // è·å–æ‰€æœ‰ POST è¯·æ±‚\n   * const postRoutes = registry.filterBy(r => r.method === 'POST')\n   * ```\n   */\n  filterBy(predicate: (route: RouteMeta) => boolean): RouteMeta[] {\n    return this.routes.filter(predicate)\n  }\n\n  /**\n   * è·å–è·¯ç”±æ•°é‡\n   */\n  get size(): number {\n    return this.routes.length\n  }\n\n  /**\n   * éå†æ‰€æœ‰è·¯ç”±\n   */\n  forEach(callback: (route: RouteMeta, index: number) => void): void {\n    this.routes.forEach(callback)\n  }\n\n  /**\n   * æ˜ å°„æ‰€æœ‰è·¯ç”±\n   */\n  map<R>(callback: (route: RouteMeta, index: number) => R): R[] {\n    return this.routes.map(callback)\n  }\n}\n\n/**\n * åˆ›å»ºè·¯ç”±æ³¨å†Œè¡¨\n *\n * @example\n * ```typescript\n * // å®šä¹‰æ‰©å±•å­—æ®µç±»å‹\n * interface MyRouteMeta {\n *   webhook?: { eventKey: string }\n *   permission?: string\n * }\n *\n * // åˆ›å»ºå¸¦ç±»å‹çš„æ³¨å†Œè¡¨\n * const registry = createRouteRegistry<MyRouteMeta>(server.getRoutes())\n *\n * // ç±»å‹å®‰å…¨çš„æŸ¥è¯¢\n * const route = registry.get('POST', '/auth/signIn')\n * if (route?.webhook) {\n *   console.log(route.webhook.eventKey)\n * }\n * ```\n */\nexport function createRouteRegistry<T extends Record<string, unknown> = Record<string, unknown>>(\n  routes: FlattenedRoute[]\n): RouteRegistry<T> {\n  return new RouteRegistry<T>(routes)\n}\n\n// ============================================\n// å…¨å±€ Registryï¼ˆå•ä¾‹æ¨¡å¼ï¼‰\n// ============================================\n\n/** å…¨å±€ registry å®ä¾‹ */\nlet globalRegistry: RouteRegistry | null = null\n\n/**\n * è®¾ç½®å…¨å±€ registryï¼ˆæ¡†æ¶å†…éƒ¨ä½¿ç”¨ï¼‰\n * @internal\n */\nexport function setGlobalRegistry(registry: RouteRegistry): void {\n  globalRegistry = registry\n}\n\n/**\n * è·å–å…¨å±€è·¯ç”±æ³¨å†Œè¡¨\n *\n * @example\n * ```typescript\n * // åœ¨ä»»æ„æ–‡ä»¶ä¸­\n * import { getRouteRegistry } from 'vafast'\n *\n * const registry = getRouteRegistry()\n * const webhookRoutes = registry.filter('webhook')\n * ```\n *\n * @throws å¦‚æœ Server å°šæœªåˆ›å»º\n */\nexport function getRouteRegistry<T extends Record<string, unknown> = Record<string, unknown>>(): RouteRegistry<T> {\n  if (!globalRegistry) {\n    throw new Error('RouteRegistry not initialized. Make sure Server is created first.')\n  }\n  return globalRegistry as RouteRegistry<T>\n}\n\n/**\n * æŒ‰ method + path è·å–å•ä¸ªè·¯ç”±\n *\n * ä¾¿æ·å‡½æ•°ï¼Œæ— éœ€å…ˆè·å– registry\n *\n * @example\n * ```typescript\n * // åœ¨ä¸­é—´ä»¶æˆ–æ¥å£ä¸­\n * import { getRoute } from 'vafast'\n *\n * const route = getRoute('POST', '/auth/signIn')\n * if (route?.webhook) {\n *   console.log('This route has webhook:', route.webhook)\n * }\n * ```\n */\nexport function getRoute<T extends Record<string, unknown> = Record<string, unknown>>(\n  method: string,\n  path: string\n): (RouteMeta & T) | undefined {\n  return getRouteRegistry<T>().get(method, path)\n}\n\n/**\n * è·å–æ‰€æœ‰è·¯ç”±\n *\n * @example\n * ```typescript\n * import { getAllRoutes } from 'vafast'\n *\n * const routes = getAllRoutes()\n * console.log(`Total ${routes.length} routes`)\n * ```\n */\nexport function getAllRoutes(): RouteMeta[] {\n  return getRouteRegistry().getAll()\n}\n\n/**\n * ç­›é€‰æœ‰ç‰¹å®šå­—æ®µçš„è·¯ç”±\n *\n * @example\n * ```typescript\n * import { filterRoutes } from 'vafast'\n *\n * // è·å–æ‰€æœ‰é…ç½®äº† webhook çš„è·¯ç”±\n * const webhookRoutes = filterRoutes('webhook')\n * ```\n */\nexport function filterRoutes<K extends string>(field: K): (RouteMeta & Record<K, unknown>)[] {\n  return getRouteRegistry().filter(field)\n}\n\n"],"mappings":"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","names":["text","stream","stream"]}