import { Server } from '../server/server.js';
import '../types/types.js';
import '../server/base-server.js';

/**
 * 原生监控装饰器
 *
 * 通过装饰器模式为 Server 添加监控能力，完全不入侵原类
 *
 * @author Framework Team
 * @version 2.0.0
 * @license MIT
 */

interface NativeMonitoringConfig {
    enabled?: boolean;
    console?: boolean;
    slowThreshold?: number;
    errorThreshold?: number;
    tags?: Record<string, string>;
}
interface NativeMonitoringMetrics {
    requestId: string;
    method: string;
    path: string;
    statusCode: number;
    totalTime: number;
    timestamp: number;
    memoryUsage: {
        heapUsed: number;
        heapTotal: number;
    };
}
interface MonitoredServer extends Server {
    getMonitoringStatus(): any;
    getMonitoringMetrics(): NativeMonitoringMetrics[];
    resetMonitoring(): void;
    fetch: (req: Request) => Promise<Response>;
    use: (mw: any) => void;
}
declare function withMonitoring(server: Server, config?: NativeMonitoringConfig): MonitoredServer;
declare function createMonitoredServer(routes: any[], config?: NativeMonitoringConfig): MonitoredServer;

export { type MonitoredServer, type NativeMonitoringConfig, type NativeMonitoringMetrics, createMonitoredServer, withMonitoring };
