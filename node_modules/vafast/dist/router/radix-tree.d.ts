import { Middleware, Handler, Method } from '../types/types.js';

/**
 * Radix Tree 路由匹配器
 *
 * 高性能路由匹配实现，时间复杂度 O(k)，k 为路径段数
 *
 * 支持的路由模式:
 * - 静态路径: /users, /api/v1/health
 * - 动态参数: /users/:id, /posts/:postId/comments/:commentId
 * - 通配符: /files/*, /static/*filepath
 */

/** 预编译的处理器类型 */
type CompiledHandler = (req: Request) => Promise<Response>;
/** 路由匹配结果 */
interface MatchResult {
    handler: Handler;
    middleware: Middleware[];
    params: Record<string, string>;
    /** 预编译后的完整处理链 */
    compiled?: CompiledHandler;
}
/**
 * Radix Tree 路由器
 *
 * @example
 * ```typescript
 * const router = new RadixRouter();
 * router.register("GET", "/users/:id", handler);
 * const result = router.match("GET", "/users/123");
 * // result.params = { id: "123" }
 * ```
 */
declare class RadixRouter {
    private root;
    constructor();
    private createNode;
    /** 分割路径 */
    private splitPath;
    /** 编译器函数 - 用于预编译中间件链 */
    private compiler?;
    /** 设置中间件编译器 */
    setCompiler(compiler: (middleware: Middleware[], handler: Handler) => CompiledHandler): void;
    /** 注册路由 */
    register(method: Method, pattern: string, handler: Handler, middleware?: Middleware[]): void;
    /** 预编译所有路由（在添加全局中间件后调用） */
    precompileAll(globalMiddleware: Middleware[]): void;
    private precompileNode;
    /** 匹配路由 */
    match(method: Method, path: string): MatchResult | null;
    /** 递归匹配节点 (优先级: 静态 > 动态参数 > 通配符) */
    private matchNode;
    /** 获取路径允许的 HTTP 方法 */
    getAllowedMethods(path: string): Method[];
    /** 查找节点（不提取参数） */
    private findNode;
    /** 获取所有已注册的路由 */
    getRoutes(): Array<{
        method: Method;
        path: string;
    }>;
    private collectRoutes;
}

export { type MatchResult, RadixRouter };
