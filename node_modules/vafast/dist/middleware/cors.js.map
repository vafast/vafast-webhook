{"version":3,"sources":["../../src/middleware/cors.ts"],"sourcesContent":["import type { Middleware } from \"../types\";\n\nexport interface CORSOptions {\n  origin?: string[] | \"*\";\n  methods?: string[];\n  headers?: string[];\n  credentials?: boolean;\n  maxAge?: number;\n}\n\nexport function createCORS(options: CORSOptions = {}): Middleware {\n  const {\n    origin = [],\n    methods = [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"],\n    headers = [],\n    credentials = false,\n    maxAge,\n  } = options;\n\n  return async (req, next) => {\n    const reqOrigin = req.headers.get(\"Origin\") || \"\";\n\n    // 判断：是否为允许的 Origin？\n    const isAllowedOrigin = origin === \"*\" || origin.includes(reqOrigin);\n\n    // 预检 (OPTIONS) 请求处理\n    if (req.method === \"OPTIONS\") {\n      const resHeaders = new Headers();\n\n      if (isAllowedOrigin) {\n        resHeaders.set(\n          \"Access-Control-Allow-Origin\",\n          origin === \"*\" ? \"*\" : reqOrigin,\n        );\n        resHeaders.set(\"Access-Control-Allow-Methods\", methods.join(\",\"));\n        resHeaders.set(\"Access-Control-Allow-Headers\", headers.join(\",\"));\n        if (credentials)\n          resHeaders.set(\"Access-Control-Allow-Credentials\", \"true\");\n        if (maxAge) resHeaders.set(\"Access-Control-Max-Age\", maxAge.toString());\n      }\n\n      return new Response(null, { status: 204, headers: resHeaders });\n    }\n\n    // 正常请求：在 next 后添加头部\n    const res = await next();\n\n    if (isAllowedOrigin) {\n      res.headers.set(\n        \"Access-Control-Allow-Origin\",\n        origin === \"*\" ? \"*\" : reqOrigin,\n      );\n      if (credentials)\n        res.headers.set(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n\n    return res;\n  };\n}\n"],"mappings":";AAUO,SAAS,WAAW,UAAuB,CAAC,GAAe;AAChE,QAAM;AAAA,IACJ,SAAS,CAAC;AAAA,IACV,UAAU,CAAC,OAAO,QAAQ,OAAO,UAAU,SAAS;AAAA,IACpD,UAAU,CAAC;AAAA,IACX,cAAc;AAAA,IACd;AAAA,EACF,IAAI;AAEJ,SAAO,OAAO,KAAK,SAAS;AAC1B,UAAM,YAAY,IAAI,QAAQ,IAAI,QAAQ,KAAK;AAG/C,UAAM,kBAAkB,WAAW,OAAO,OAAO,SAAS,SAAS;AAGnE,QAAI,IAAI,WAAW,WAAW;AAC5B,YAAM,aAAa,IAAI,QAAQ;AAE/B,UAAI,iBAAiB;AACnB,mBAAW;AAAA,UACT;AAAA,UACA,WAAW,MAAM,MAAM;AAAA,QACzB;AACA,mBAAW,IAAI,gCAAgC,QAAQ,KAAK,GAAG,CAAC;AAChE,mBAAW,IAAI,gCAAgC,QAAQ,KAAK,GAAG,CAAC;AAChE,YAAI;AACF,qBAAW,IAAI,oCAAoC,MAAM;AAC3D,YAAI,OAAQ,YAAW,IAAI,0BAA0B,OAAO,SAAS,CAAC;AAAA,MACxE;AAEA,aAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,KAAK,SAAS,WAAW,CAAC;AAAA,IAChE;AAGA,UAAM,MAAM,MAAM,KAAK;AAEvB,QAAI,iBAAiB;AACnB,UAAI,QAAQ;AAAA,QACV;AAAA,QACA,WAAW,MAAM,MAAM;AAAA,MACzB;AACA,UAAI;AACF,YAAI,QAAQ,IAAI,oCAAoC,MAAM;AAAA,IAC9D;AAEA,WAAO;AAAA,EACT;AACF;","names":[]}