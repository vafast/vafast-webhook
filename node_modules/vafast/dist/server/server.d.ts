import { Route, NestedRoute, Method, FlattenedRoute } from '../types/types.js';
import { BaseServer } from './base-server.js';

/**
 * Vafast 核心服务器
 *
 * 基于 Radix Tree 的高性能路由匹配
 * 时间复杂度: O(k)，k 为路径段数
 */

/**
 * Vafast 服务器
 *
 * @example
 * ```typescript
 * const server = new Server([
 *   { method: "GET", path: "/", handler: () => new Response("Hello") },
 * ]);
 * export default { fetch: server.fetch };
 * ```
 */
declare class Server extends BaseServer {
    private router;
    private routes;
    /** 是否已预编译 */
    private isCompiled;
    /** 预编译时的全局中间件数量 */
    private compiledWithMiddlewareCount;
    constructor(routes?: (Route | NestedRoute)[]);
    /**
     * 预编译所有路由处理链
     * 在添加所有路由和全局中间件后调用，可提升运行时性能
     */
    compile(): this;
    private registerRoutes;
    /** 快速提取 pathname */
    private extractPathname;
    /** 生成 404/405 响应 */
    private createErrorResponse;
    /** 处理请求 */
    fetch: (req: Request) => Promise<Response>;
    addRoute(route: Route): void;
    addRoutes(routes: (Route | NestedRoute)[]): void;
    getRoutes(): Array<{
        method: Method;
        path: string;
    }>;
    /**
     * 获取完整的路由元信息（不含 handler 和 middleware）
     *
     * 用于 API 文档生成、Webhook 事件注册、权限检查等场景
     *
     * @example
     * ```typescript
     * const routes = server.getRoutesWithMeta()
     * for (const route of routes) {
     *   console.log(route.fullPath, route.name, route.description)
     * }
     * ```
     */
    getRoutesWithMeta(): FlattenedRoute[];
}

export { Server };
